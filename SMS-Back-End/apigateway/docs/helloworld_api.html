<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>helloworld_api.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>helloworld_api.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Hello World API implemented using Google Cloud Endpoints.</p>
<p>Defined here are the ProtoRPC messages needed to define Schemas for methods
as well as those methods defined in an API.</p>
<p>Para ver el servidor de exploración:</p>
<pre><code>https://your_app_id.appspot.com/_ah/api/explorer
</code></pre>
<blockquote>
<p>Estandar de log por terminal &lt;</p>
</blockquote>
<p>Intentamos que el código tenga la mayor depuración posible por terminal ya que son tantos pasos de mensajes
 que es más fácil de detectar errores así. Existe una variable v=1 (por defecto) que habilita todos los mensajes y se sigue
 un estandar más o menos regular.</p>
<p>Cuando se realiza la llamada a un método de la api se añade justo a la entrada el bloque (ajustado al método):</p>
<pre><code> #Info de seguimiento
 if v:
     print nombreMicroservicio
     print ' Petición GET a profesores.getProfesor'
     print ' Request: \n '+str(request)+'\n'
</code></pre>
<p>y para conocer la salida otro que siga el formato:</p>
<pre><code> #Info de seguimiento
 if v:
     print nombreMicroservicio
     print ' Return: '+str(profesor)+'\n'
</code></pre>
<p>para saber a que método se ha llamado y con qué parámetros.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">endpoints</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>https://cloud.google.com/appengine/docs/python/tools/protorpc/messages/messageclass</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">protorpc</span> <span class="kn">import</span> <span class="n">messages</span>
<span class="kn">from</span> <span class="nn">protorpc</span> <span class="kn">import</span> <span class="n">message_types</span>
<span class="kn">from</span> <span class="nn">protorpc</span> <span class="kn">import</span> <span class="n">remote</span>
<span class="kn">import</span> <span class="nn">os</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Doc de urlfetch: https://cloud.google.com/appengine/docs/python/refdocs/google.appengine.api.urlfetch
Librerías usadas para la llamada a las APIRest de los microservicios</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">google.appengine.api</span> <span class="kn">import</span> <span class="n">urlfetch</span>
<span class="kn">import</span> <span class="nn">urllib</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Para el descubrimiento de los módulos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">from</span> <span class="nn">google.appengine.api</span> <span class="kn">import</span> <span class="n">modules</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Para la decodificaciónd e los datos recibidos en JSON desde las APIs</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">jsonpickle</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">manejadorImagenes</span> <span class="kn">import</span> <span class="n">ManejadorImagenes</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Variable habilitadora del modo verbose</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">v</span><span class="o">=</span><span class="bp">True</span>

<span class="n">nombreMicroservicio</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> ## API Gateway ##&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>TODO: Replace the following lines with client IDs obtained from the APIs
Console or Cloud Console.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">WEB_CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;replace this with your web client application ID&#39;</span>
<span class="n">ANDROID_CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;replace this with your Android client ID&#39;</span>
<span class="n">IOS_CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;replace this with your iOS client ID&#39;</span>
<span class="n">ANDROID_AUDIENCE</span> <span class="o">=</span> <span class="n">WEB_CLIENT_ID</span>


<span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;Hello&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Función que recibe una cadena como parámetro y la formatea para resolver el problema de los acentos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">formatText</span><span class="p">(</span><span class="n">cadena</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">cadena</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">formatTextInput</span><span class="p">(</span><span class="n">cadena</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">cadena</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">MensajeRespuesta</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Mensaje que usamos para devolver la información de estado sobre la creación de alguna entidad en el sistema y además devuelve el id en sistema de la identidad creada. (Como por ejemplo en la insercción de un alumno)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">StatusID</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">statusCode</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">URL</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Como vemos, no aparecen argumentos en el cuerpo de la petición ya que se trata
de una petición de tipo GET.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">MensajePeticion</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <h6></h6>
<h1>TIPOS DE MENSAJES QUE MANEJA LA API</h1>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>A continuación se implementa la estrutura de cada tipo de mensaje que se puede enviar o recibir en
el proyecto en el microservicio de apigateway.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Alumno</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">apellidos</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">AlumnoCompleto</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">apellidos</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">dni</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">direccion</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">localidad</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">provincia</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">fecha_nacimiento</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">telefono</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">imagen</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ID</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ListaAlumnos</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">alumnos</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">Alumno</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Profesor</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">apellidos</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ProfesorCompleto</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">apellidos</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">dni</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">direccion</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">localidad</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">provincia</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">fecha_nacimiento</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">telefono</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ListaProfesores</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">profesores</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">Profesor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Asignatura</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">AsignaturaCompleta</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ListaAsignaturas</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">asignaturas</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">Asignatura</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Clase</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">curso</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">grupo</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">nivel</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Para ampliar en el futuro y no usar el mismo tipo de mensaje:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ClaseCompleta</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">curso</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">grupo</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">nivel</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ListaClases</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">clases</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">Clase</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Matricula</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">id_matricula</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">id_alumno</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">id_asociacion</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ListaMatriculas</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">matriculas</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">Matricula</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Imparte</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">id_imparte</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">id_profesor</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">id_asociacion</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ListaImpartes</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">impartes</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">Imparte</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Asociacion</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">id_asociacion</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">id_clase</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">id_asignatura</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">nombreAsignatura</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">nombreClase</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ListaAsociaciones</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">asociaciones</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">Asociacion</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>Un nuevo tipo de mensaje para el profesor simple que añade un poco de información necesaria</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ProfesorSimpleExtendido</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">apellidos</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">idImparte</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">AlumnoSimpleExtendido</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">apellidos</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">idMatricula</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <h6></h6>
<h1>Mensajes del servicio de Control de Estudiantes</h1>
<h6></h6>
<p>Estructura de mensajes intercambiados en el servicio de Control de estudiantes (sce)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ControlAsistencia</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span> <span class="c1">#Debería llamarse mControlAsistencia (micro)</span>
    <span class="n">asistencia</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>Si el retraso es 0: no hay retraso 10: retraso de 10 min 20: retraso de 20 min o más</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">retraso</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">retrasoJustificado</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">uniforme</span> <span class="o">=</span>  <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>Campo solo necesario para los controles de asistencia de salida, proceso: obtenerControlAsistencia</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">nombreAlumno</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>Campos solo necesarios para los controles de asistencia de salida, proceso:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ListaControlAsistencia</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>  <span class="c1">#Debería llamarse ControlAsistencia</span>
    <span class="n">controles</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">ControlAsistencia</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">idProfesor</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">idClase</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">idAsignatura</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">nombreClase</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">nombreAsignatura</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">nombreProfesor</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">fecha</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ResumenControlAsistencia</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">fecha</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">idClase</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">nombreClase</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">idAsignatura</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">nombreAsignatura</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">idProfesor</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">nombreProfesor</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ListaResumenControlAsistencia</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">resumenes</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">ResumenControlAsistencia</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>Cuando pedimos los resumenes de los controles de asistencia los podemos pedir usando parámetros o sin ellos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ParametrosPeticionResumen</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">idProfesor</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">idAsignatura</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">idClase</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fechaHora</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <h3>FIN DE LOS MENSAJES PARA EL SCE</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>Definimos un tipo especial de mensaje</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">AsociacionCompleta</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">nombreAsignatura</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">listaProfesores</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">ProfesorSimpleExtendido</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">listaAlumnos</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">MessageField</span><span class="p">(</span><span class="n">AlumnoSimpleExtendido</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">idAsociacion</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">salidaLogin</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">idUser</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">rol</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>Decorador que establace nombre y versión de la api
Helloworld API v1.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@endpoints.api</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;helloworld&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;v1&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HelloWorldApi</span><span class="p">(</span><span class="n">remote</span><span class="o">.</span><span class="n">Service</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">message_types</span><span class="o">.</span><span class="n">VoidMessage</span><span class="p">,</span> <span class="n">MensajeRespuesta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;holaMundo&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;holaMundo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getSaludoHolaMundo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Función de prueba de exposición.</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/holaMundo</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;Hola mundo! </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <h6></h6>
<h1>métodos de ALUMNOS</h1>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">message_types</span><span class="o">.</span><span class="n">VoidMessage</span><span class="p">,</span> <span class="n">ListaAlumnos</span><span class="p">,</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <p>path=nombre del recurso a llamar</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                      <span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/getAlumnos&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>Puede que sea la forma en la que se llama desde la api:
response = service.alumnos().listGreeting().execute()</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                      <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.getAlumnos&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <p>getAlumnos()   [GET sin parámetros]</p>
<p>Devuelve una lista con todos los estudiantes registrados en el sistema, de forma simplificada (solo nombre y ID)</p>
<p>Llamada desde terminal:
curl -X GET localhost:8001/_ah/api/helloworld/v1/alumnos/getAlumnos
Llamada desde JavaScript:
response =service.alumnos().getAlumnos().execute()</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">getAlumnos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_request</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      <p>Transformación de la llamada al endpoints a la llamada a la api rest del servicio.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición GET a alumnos.getAlumnos&quot;</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      <p>Conexión a un microservicio específico:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      <p>Le decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;alumnos&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <p>result = urllib2.urlopen(url)
print result</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      <p>Llamamos al microservicio y recibimos los resultados con URLFetch
Al no especificar nada se llama al método GET de la URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      <p>Vamos a intentar consumir los datos en JSON y convertirlos a un mensje enviable :)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultados de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">listaAlumnos</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      <p>miListaAlumnos=ListaAlumnos()
miListaAlumnos.alumnos = listaAlumnos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">alumnosItems</span><span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      <p>Que rellenamos con todo los alumnos de la listaAlumnos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Construcción del mensaje de salida: </span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">alumno</span> <span class="ow">in</span> <span class="n">listaAlumnos</span><span class="p">:</span>
            <span class="n">idAlumno</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>
            <span class="n">nombreAlumno</span> <span class="o">=</span> <span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)</span>
            <span class="n">apellidosAlumno</span> <span class="o">=</span> <span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">)</span>

            <span class="n">alumnosItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Alumno</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="n">idAlumno</span><span class="p">,</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">nombreAlumno</span><span class="p">),</span> <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">apellidosAlumno</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>


        <span class="k">return</span> <span class="n">ListaAlumnos</span><span class="p">(</span><span class="n">alumnos</span><span class="o">=</span><span class="n">alumnosItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      <p>getAlumno() [GET con dni]</p>
<p>Devuelve toda la información de un estudiante en caso de estar en el sistema.</p>
<p>Llamada ejemplo desde terminal:
curl -X GET localhost:8001/_ah/api/helloworld/v1/alumnos/getAlumno?id=2</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">AlumnoCompleto</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/getAlumno&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.getAlumno&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAlumno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición GET a alumnos.getAlumno&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;request: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      <p>Cuando se llama a este recurso lo que se quiere es recibir toda la información
de una entidad Alumno, para ello primero vamos a recuperar la información del microsrevicio apropiado:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      <p>Conexión a un microservicio específico:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      <p>Le decimos al microservicio que queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      <p>Según la doc. de urlfetch (ver arriba) no podemos pasar parámetros con el payload, así que como conocemos
la api del microservicios al que vamos a llamr realizamos la petición bajo su especificacion, según la cual
solo tenemos que llamar a /alumnos/<id_alumno> entonces concatenamos a la url esa id qu recibimos en la llamada
a este procedimiento.</p>
<p>Recursos más entidad</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;alumnos/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      <p>Petición al microservicio</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>

        <span class="k">print</span> <span class="s2">&quot;RESULTADO:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      <p>print result.content</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;400&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;404&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">NotFoundException</span><span class="p">(</span><span class="s1">&#39;Alumno con ID </span><span class="si">%s</span><span class="s1"> no encontrado.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="p">))</span>

        <span class="n">alumno</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Código de estado: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-79'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-79'>#</a>
      </div>
      <p>Componemos un mensaje de tipo AlumnoCompleto.
Las partes que son enteros las pasamos a string para enviarlos como mensajes de tipo string.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-80'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-80'>#</a>
      </div>
      <p>Ojo, solo los elementos que no sean null se enviarán. Cuando un alumno no tenga imagen y pr tanto su valor
en la base de datos sea null no se recibirá el campo imagen en el JSON que la API G devuelve.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">alumno</span> <span class="o">=</span> <span class="n">AlumnoCompleto</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span>
                                <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span>
                                <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">)),</span>
                                <span class="n">dni</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dni&#39;</span><span class="p">)),</span>
                                <span class="n">direccion</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;direccion&#39;</span><span class="p">)),</span>
                                <span class="n">localidad</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;localidad&#39;</span><span class="p">)),</span>
                                <span class="n">provincia</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;provincia&#39;</span><span class="p">)),</span>
                                <span class="n">fecha_nacimiento</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fecha_nacimiento&#39;</span><span class="p">)),</span>
                                <span class="n">telefono</span><span class="o">=</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;telefono&#39;</span><span class="p">),</span>
                                <span class="n">imagen</span><span class="o">=</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;urlImagen&#39;</span><span class="p">)</span>
                                <span class="p">)</span>

        <span class="k">return</span> <span class="n">alumno</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-81'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-81'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">class</span> <span class="nc">AlumnoCompletoConImagen</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">nombre</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">apellidos</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">dni</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">direccion</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">localidad</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">provincia</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">fecha_nacimiento</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">telefono</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-82'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-82'>#</a>
      </div>
      <p>En esta ocasión la imagen no es una URL sino los Bytes en crudo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">imagen</span>  <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">BytesField</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-83'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-83'>#</a>
      </div>
      <p>Función que inserta un alumno en el sistema con o sin imagen.</p>
<p>Ejemplo de llamada SIN imagen:
curl -i -d "nombre=Juan&amp;apellidos=Fernandez&amp;dni=45301218&amp;direccion=Calle&amp;localidad=Jerezfrontera&amp;provincia=Granada&amp;fecha_nacimiento=1988-2-6&amp;telefono=699164459" -X POST -G localhost:8001/_ah/api/helloworld/v1/alumnos/insertarAlumno2</p>
<p>Ejmplo de llamada CON imagen:</p>
<p>curl -d "nombre=Juan&amp;apellidos=Fernandez&amp;dni=45301218&amp;direccion=Calle&amp;localidad=Jerezfrontera&amp;provincia=Granada&amp;fecha_nacimiento=1988-2-6&amp;telefono=699164459" --data-urlencode 'imagen='"$( base64 profile.jpg)"''  -X POST -G localhost:8001/_ah/api/helloworld/v1/alumnos/insertarAlumno2</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">AlumnoCompletoConImagen</span><span class="p">,</span> <span class="n">StatusID</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/insertarAlumno2&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.insertarAlumno2&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">insertar_alumno2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-84'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-84'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a alumnos.insertarAlumno2&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="n">request</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-85'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-85'>#</a>
      </div>
      <p>Construimos un diccionario con los datos del alumno recibidos en la petición.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">datos</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;nombre&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="p">),</span>
          <span class="s2">&quot;apellidos&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="p">),</span>
          <span class="s2">&quot;dni&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="p">,</span>
          <span class="s2">&quot;direccion&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="p">),</span>
          <span class="s2">&quot;localidad&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="p">),</span>
          <span class="s2">&quot;provincia&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="p">),</span>
          <span class="s2">&quot;fecha_nacimiento&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="p">,</span>
          <span class="s2">&quot;telefono&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-86'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-86'>#</a>
      </div>
      <p>Sea con imagen o sin imagen insertamos al alumno en el sistema:
Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-87'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-87'>#</a>
      </div>
      <p>Añadimos el servicio al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;alumnos&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-88'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-88'>#</a>
      </div>
      <p>Codificamos los datos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">datos</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-89'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-89'>#</a>
      </div>
      <p>Realizamos la petición al servicio con los datos codificados al microservicio apropiado.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-90'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-90'>#</a>
      </div>
      <p>Analizamos la respuesta y si todo ha ido bien habremos recibido algo así: {'idAlumno': '42', 'status': 'OK'}</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">json</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-91'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-91'>#</a>
      </div>
      <p>Definimos el mensaje de salida:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">salida</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;OK&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-92'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-92'>#</a>
      </div>
      <p>Es que el alumno se ha guardado con éxito, entonces procedemos a guardar su imagen</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-93'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-93'>#</a>
      </div>
      <p>Si se detecta que no se ha enviado información en el campo imagen, es que no se está enviando una imagen:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;Petición a insertarAlumno2 SIN imagen en el request.</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">salida</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;Petición a insertarAlumno2 CON imagen en el request.</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-94'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-94'>#</a>
      </div>
      <p>Pero antes ponemos el nombre de forma correcta, usando el id del alumno y la extensión de la imagen</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">nombreImagen</span> <span class="o">=</span> <span class="s1">&#39;alumnos/imagenes_perfil/&#39;</span> <span class="o">+</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;idAlumno&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span>

                <span class="n">urlImagenAlumno</span> <span class="o">=</span> <span class="n">ManejadorImagenes</span><span class="o">.</span><span class="n">CreateFile</span><span class="p">(</span><span class="n">nombreImagen</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-95'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-95'>#</a>
      </div>
      <p>Una vez guardada la imagen pasamos a setear el campo imagen del alumno en cuestión.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">url2</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
                <span class="n">url2</span><span class="o">+=</span><span class="s2">&quot;alumnos/&quot;</span><span class="o">+</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;idAlumno&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-96'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-96'>#</a>
      </div>
      <p>Añadimos la imagen a los datos:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">datos</span><span class="p">[</span><span class="s1">&#39;imagen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">urlImagenAlumno</span><span class="p">;</span>

                <span class="n">resultadoModificacion</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url2</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">datos</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

                <span class="k">print</span> <span class="s1">&#39;Resultado Modificacion&#39;</span>
                <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">resultadoModificacion</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="n">salida</span> <span class="o">=</span> <span class="n">resultadoModificacion</span><span class="o">.</span><span class="n">content</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-97'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-97'>#</a>
      </div>
      <p>json2 = jsonpickle.decode(resultadoModificacion.content)
salida = json2['status']</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">StatusID</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">salida</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;idAlumno&#39;</span><span class="p">]))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-98'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-98'>#</a>
      </div>
      <h3>possibly deprecated</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">AlumnoCompleto</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/insertarAlumno&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.insertarAlumno&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">insertar_alumno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        insertarAlumno()  [POST con todos los atributos de un alumno]</span>

<span class="sd">        Introduce un nuevo alumno en el sistema.</span>

<span class="sd">        Ejemplo de llamada en terminal:</span>
<span class="sd">        curl -i -d &quot;nombre=Juan&amp;dni=45301218Z&amp;direccion=Calle&amp;localidad=Jerezfrontera&amp;provincia=Granada&amp;fecha_nacimiento=1988-2-6&amp;telefono=699164459&quot; -X POST -G localhost:8001/_ah/api/helloworld/v1/alumnos/insertarAlumno</span>
<span class="sd">        (-i para ver las cabeceras)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a alumnos.insertarAlumno&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-99'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-99'>#</a>
      </div>
      <p>Si no tenemos todos los atributos entonces enviamos un error de bad request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-100'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-100'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-101'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-101'>#</a>
      </div>
      <p>Añadimos el servicio al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;alumnos&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-102'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-102'>#</a>
      </div>
      <p>Extraemos lo datos de la petición al endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;nombre&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="p">),</span>
          <span class="s2">&quot;apellidos&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="p">),</span>
          <span class="s2">&quot;dni&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="p">,</span>
          <span class="s2">&quot;direccion&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="p">),</span>
          <span class="s2">&quot;localidad&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="p">),</span>
          <span class="s2">&quot;provincia&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="p">),</span>
          <span class="s2">&quot;fecha_nacimiento&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="p">,</span>
          <span class="s2">&quot;telefono&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;Hay imagen recibida en insertarAlumno()&#39;</span>
            <span class="n">form_fields</span><span class="p">[</span><span class="s1">&#39;imagen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span>
            <span class="k">print</span> <span class="n">form_fields</span>


        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span>
            <span class="k">print</span> <span class="s1">&#39;DATOS&#39;</span>
            <span class="k">print</span> <span class="n">form_fields</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-103'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-103'>#</a>
      </div>
      <h1>Doc de urlfetch: https://cloud.google.com/appengine/docs/python/refdocs/google.appengine.api.urlfetch</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-104'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-104'>#</a>
      </div>
      <p>Realizamos la petición al servicio con los datos pasados al endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-105'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-105'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;404&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">NotFoundException</span><span class="p">(</span><span class="s1">&#39;Alumno con ID </span><span class="si">%s</span><span class="s1"> ya existe en el sistema.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-106'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-106'>#</a>
      </div>
      <p>return MensajeRespuesta(message="Todo OK man!")
Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-107'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-107'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/delAlumno&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.delAlumno&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">eliminar_alumno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        curl -d &quot;id=87&quot; -X DELETE -G localhost:8001/_ah/api/helloworld/v1/alumnos/delAlumno</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición DELETE a alumnos.delAlumno&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-108'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-108'>#</a>
      </div>
      <p>Ejemplo de borrado de un recurso pasando el dni de un alumno</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parece que urlfetch da problemas a al hora de pasar parámetros (payload) cuando se trata del</span>
<span class="sd">        método DELETE.</span>
<span class="sd">        Extracto de la doc:</span>
<span class="sd">        payload: POST, PUT, or PATCH payload (implies method is not GET, HEAD, or DELETE). this is ignored if the method is not POST, PUT, or PATCH.</span>
<span class="sd">        Además no somos los primeros en encontrarse este problema:</span>
<span class="sd">        http://grokbase.com/t/gg/google-appengine/13bvr5qjyq/is-there-any-reason-that-urlfetch-delete-method-does-not-support-a-payload</span>

<span class="sd">        Por eso en lugar de pasar los datos por payload los añadimos a la url, que es algo equivalente.</span>

<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-109'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-109'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;alumnos/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-110'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-110'>#</a>
      </div>
      <p>Extraemos el argumento id de la petición y la añadimos a la URL</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">datosAlumno</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>
        <span class="n">jsonDatosAlumno</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">datosAlumno</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-111'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-111'>#</a>
      </div>
      <ol>
<li>Primero consultamos si ese alumno tenía imagen (porque tendremos que borrarla del Cloud Storage)</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;urlImagen&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;NULL&#39;</span><span class="p">):</span>

            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Modificando imagen actual del usuario con id: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-112'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-112'>#</a>
      </div>
      <ol>
<li>Si se tiene imagen se manda a borrar</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">nombreImagen</span> <span class="o">=</span> <span class="s1">&#39;alumnos/imagenes_perfil/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-113'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-113'>#</a>
      </div>
      <ol>
<li>Se ha de borrar la antigua imagen del Cloud Storage
Primero componenmos el nombre de aso aimagen:</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">print</span> <span class="s1">&#39;Eliminacion imagen:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ManejadorImagenes</span><span class="o">.</span><span class="n">DeleteFile2</span><span class="p">(</span><span class="n">nombreImagen</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-114'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-114'>#</a>
      </div>
      <p>Después se manda a borrar</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">DELETE</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-115'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-115'>#</a>
      </div>
      <ol>
<li>Realizamos la petición a la url del servicio con el método apropiado para borrarlos definitivament.</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-116'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-116'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-117'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-117'>#</a>
      </div>
      <p>Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">AlumnoCompletoConImagen</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/modAlumnoCompleto2&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.modAlumnoCompleto2&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">modificarAlumnoCompleto2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ejemplo de llamada SIN imagen:</span>
<span class="sd">        curl -i -d &quot;id=85&amp;nombre=Maria2&amp;apellidos=Fernandez&amp;dni=45301218&amp;direccion=Calle&amp;localidad=Jerezfrontera&amp;provincia=Granada&amp;fecha_nacimiento=1988-2-6&amp;telefono=699164459&quot; -X POST -G localhost:8001/_ah/api/helloworld/v1/alumnos/modAlumnoCompleto2</span>

<span class="sd">        Ejmplo de llamada CON imagen:</span>

<span class="sd">        curl -i -d &quot;id=87&amp;nombre=Juan&amp;apellidos=Fernandez&amp;dni=45301218&amp;direccion=Calle&amp;localidad=Jerezfrontera&amp;provincia=Granada&amp;fecha_nacimiento=1988-2-6&amp;telefono=699164459&quot; --data-urlencode &#39;imagen=&#39;&quot;$( base64 profile.jpg)&quot;&#39;&#39;  -X POST -G localhost:8001/_ah/api/helloworld/v1/alumnos/modAlumnoCompleto2</span>

<span class="sd">        Con otra imagen:</span>
<span class="sd">        curl -i -d &quot;id=87&amp;nombre=Juan&amp;apellidos=Fernandez&amp;dni=45301218&amp;direccion=Calle&amp;localidad=Jerezfrontera&amp;provincia=Granada&amp;fecha_nacimiento=1988-2-6&amp;telefono=699164459&quot; --data-urlencode &#39;imagen=&#39;&quot;$( base64 profile2.jpg)&quot;&#39;&#39;  -X POST -G localhost:8001/_ah/api/helloworld/v1/alumnos/modAlumnoCompleto2</span>

<span class="sd">        Ejemplo de llamada con ELIMINACION de imagen:</span>
<span class="sd">        curl -i -d &quot;imagen=ZGVs&amp;id=87&amp;nombre=Juan&amp;apellidos=Fernandez&amp;dni=45301218&amp;direccion=Calle&amp;localidad=Jerezfrontera&amp;provincia=Granada&amp;fecha_nacimiento=1988-2-6&amp;telefono=699164459&quot;   -X POST -G localhost:8001/_ah/api/helloworld/v1/alumnos/modAlumnoCompleto2</span>


<span class="sd">        Ojo!</span>
<span class="sd">        En el caso de que traiga una imagen debe comprobar que es distinta (la url) a la que el usuario ya disponía y en caso de serlo mandar</span>
<span class="sd">        a borrar la antigua imagen con el manejador de imágenes y solo cuando se haya grabado correctamente en la base de datos el usuario</span>
<span class="sd">        y eliminada correctamente la foto del datastore enviar el ok.</span>


<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a alumnos.modAlumnoCompleto2&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-118'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-118'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>



        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-119'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-119'>#</a>
      </div>
      <p>print str(request)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;alumnos/&quot;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-120'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-120'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos, colección alumnos / alumno con id concreto.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">datos</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;nombre&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="p">),</span>
          <span class="s2">&quot;apellidos&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="p">),</span>
          <span class="s2">&quot;dni&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="p">),</span>
          <span class="s2">&quot;direccion&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="p">),</span>
          <span class="s2">&quot;localidad&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="p">),</span>
          <span class="s2">&quot;provincia&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="p">),</span>
          <span class="s2">&quot;fecha_nacimiento&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="p">,</span>
          <span class="s2">&quot;telefono&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-121'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-121'>#</a>
      </div>
      <p>Extraemos lo datos de la petición que se reciben aquí en el endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">HAY imagen, la imagen actual se quiere actualizar. </span><span class="se">\n\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-122'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-122'>#</a>
      </div>
      <p>La imagen se quiere sustituir #</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">datosAlumno</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>
            <span class="n">jsonDatosAlumno</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">datosAlumno</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

            <span class="k">print</span> <span class="n">jsonDatosAlumno</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-123'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-123'>#</a>
      </div>
      <ol>
<li>Averiguamos si el usuario tenía imagen ya o no, para borrarla, usamos la url especificada antes pero con el metodo GET</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;urlImagen&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;NULL&#39;</span><span class="p">):</span>

                <span class="k">print</span> <span class="s1">&#39;Grabando imagen al usuario con id: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-124'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-124'>#</a>
      </div>
      <h3>Si el usuario no tenía imagen:</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">nombreImagen</span> <span class="o">=</span> <span class="s1">&#39;alumnos/imagenes_perfil/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span>

                <span class="n">urlImagenAlumno</span> <span class="o">=</span> <span class="n">ManejadorImagenes</span><span class="o">.</span><span class="n">CreateFile</span><span class="p">(</span><span class="n">nombreImagen</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-125'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-125'>#</a>
      </div>
      <ol>
<li>Se graba la imagen en el Cloud Storage</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-126'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-126'>#</a>
      </div>
      <ol>
<li>Y después se modifican los datos del alumno, añadiendo la url a esta</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">url2</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
                <span class="n">url2</span><span class="o">+=</span><span class="s2">&quot;alumnos/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-127'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-127'>#</a>
      </div>
      <p>Una vez guardada la imagen pasamos a setear el campo imagen del alumno en cuestión.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">datos</span><span class="p">[</span><span class="s1">&#39;imagen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">urlImagenAlumno</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-128'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-128'>#</a>
      </div>
      <p>Añadimos la imagen a los datos:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">resultadoModificacion</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url2</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">datos</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

                <span class="k">print</span> <span class="s1">&#39;Resultado Modificacion&#39;</span>
                <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">resultadoModificacion</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-129'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-129'>#</a>
      </div>
      <p>Realizamos la modificaion llamando a la api del microservicio.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;urlImagen&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;NULL&#39;</span><span class="p">):</span>

                <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Modificando imagen actual del usuario con id: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-130'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-130'>#</a>
      </div>
      <h3>Si el usuario SI tenía imagen</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">nombreImagen</span> <span class="o">=</span> <span class="s1">&#39;alumnos/imagenes_perfil/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-131'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-131'>#</a>
      </div>
      <ol>
<li>Se ha de borrar la antigua imagen del Cloud Storage
Primero componenmos el nombre de l aimagen:</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">print</span> <span class="s1">&#39;Eliminacion imagen:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ManejadorImagenes</span><span class="o">.</span><span class="n">DeleteFile2</span><span class="p">(</span><span class="n">nombreImagen</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-132'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-132'>#</a>
      </div>
      <p>Después se manda a borrar</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">urlImagenAlumno</span> <span class="o">=</span> <span class="n">ManejadorImagenes</span><span class="o">.</span><span class="n">CreateFile</span><span class="p">(</span><span class="n">nombreImagen</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-133'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-133'>#</a>
      </div>
      <ol>
<li>Se debe de guardar la nueva, con el mismo nombre:</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">url2</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
                <span class="n">url2</span><span class="o">+=</span><span class="s2">&quot;alumnos/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jsonDatosAlumno</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-134'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-134'>#</a>
      </div>
      <ol>
<li>Se ha de modificar la url en los datos del estudiante
Una vez guardada la imagen pasamos a setear el campo imagen del alumno en cuestión.</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">datos</span><span class="p">[</span><span class="s1">&#39;imagen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">urlImagenAlumno</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-135'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-135'>#</a>
      </div>
      <p>Añadimos la imagen a los datos:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">resultadoModificacion</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url2</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">datos</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

                <span class="k">print</span> <span class="s1">&#39;Resultado Modificacion&#39;</span>
                <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">resultadoModificacion</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-136'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-136'>#</a>
      </div>
      <p>Realizamos la modificaion llamando a la api del microservicio.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> No hay imagen </span><span class="se">\n\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-137'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-137'>#</a>
      </div>
      <p>NO HAY IMAGEN #</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">datos</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;Respuesta&#39;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>

        <span class="k">print</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-138'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-138'>#</a>
      </div>
      <p>En el caso de que no haya imagen en la petición es que se quiere mantener la que está y solo modificar los datos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span>  <span class="n">request</span><span class="o">.</span><span class="n">imagen</span> <span class="o">==</span> <span class="s1">&#39;del&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> El parámetro pasado es ZGVs (del en Base64), la imagen actual se quiere borrar. </span><span class="se">\n\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-139'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-139'>#</a>
      </div>
      <p>NO HAY IMAGEN y además se quiere eliminar la que el usuario tenga #</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">salida</span> <span class="o">=</span> <span class="n">ManejadorImagenes</span><span class="o">.</span><span class="n">DeleteFile2</span><span class="p">(</span><span class="n">nombreImagen</span> <span class="o">=</span> <span class="s1">&#39;alumnos/imagenes_perfil/&#39;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">salida</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-140'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-140'>#</a>
      </div>
      <ol>
<li>Borrar la imagen del Cloud Storage</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">datos</span><span class="p">[</span><span class="s1">&#39;imagen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span><span class="p">;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">datos</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;Respuesta&#39;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>



        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-141'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-141'>#</a>
      </div>
      <ol>
<li>Borrar la url que de la imagen tiene el user en sus datos. (modificar al alumno)</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">AlumnoCompleto</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/modAlumnoCompleto&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.modAlumnoCompleto&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">modificarAlumnoCompleto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        modificarAlumnoCompleto()  [POST]</span>

<span class="sd">        Modifica todos los atributos de un alumno, aunque algunos queden igual.</span>

<span class="sd">        curl -d &quot;id=1&amp;nombre=Pedro&amp;apellidos=Torrssr&amp;dni=23&amp;direccion=CREalCartuja&amp;localidad=Granada&amp;provincia=Granada&amp;fecha_nacimiento=1988-12-4&amp;telefono=23287282&quot; -i -X POST -G localhost:8001/_ah/api/helloworld/v1/alumnos/modAlumnoCompleto</span>
<span class="sd">        HTTP/1.1 200 OK</span>
<span class="sd">        content-type: application/json</span>
<span class="sd">        Cache-Control: no-cache</span>
<span class="sd">        Expires: Fri, 01 Jan 1990 00:00:00 GMT</span>
<span class="sd">        Server: Development/2.0</span>
<span class="sd">        Content-Length: 20</span>
<span class="sd">        Server: Development/2.0</span>
<span class="sd">        Date: Mon, 14 Mar 2016 10:17:12 GMT</span>

<span class="sd">        {</span>
<span class="sd">         &quot;message&quot;: &quot;OK&quot;</span>
<span class="sd">        }</span>


<span class="sd">        Ojo!</span>
<span class="sd">        En el caso de que traiga una imagen debe comprobar que es distinta (la url) a la que el usuario ya disponía y en caso de serlo mandar</span>
<span class="sd">        a borrar la antigua imagen con el manejador de imágenes y solo cuando se haya grabado correctamente en la base de datos el usuario</span>
<span class="sd">        y eliminada correctamente la foto del datastore enviar el ok.</span>


<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a alumnos.modAlumnoCompleto&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-142'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-142'>#</a>
      </div>
      <h3>possibly deprecated</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;alumnos/&quot;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-143'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-143'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos, colección alumnos / alumno con id concreto.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;nombre&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="p">),</span>
          <span class="s2">&quot;apellidos&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="p">),</span>
          <span class="s2">&quot;dni&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="p">),</span>
          <span class="s2">&quot;direccion&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="p">),</span>
          <span class="s2">&quot;localidad&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="p">),</span>
          <span class="s2">&quot;provincia&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="p">),</span>
          <span class="s2">&quot;fecha_nacimiento&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="p">,</span>
          <span class="s2">&quot;telefono&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span>
        <span class="p">}</span>


        <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Comprobación de la imagen recibida, esté o no</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> No hay imagen </span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">print</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span> <span class="o">==</span> <span class="s1">&#39;NULL&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;Hay imagen recibida en modAlumno()&#39;</span>
            <span class="n">form_fields</span><span class="p">[</span><span class="s1">&#39;imagen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span>
            <span class="k">print</span> <span class="n">form_fields</span>


            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            En este momento se está recibiendo una URL en el campo imagen y por tanto tenemos que comprobar si es la misma que el usuario ya tenía.</span>
<span class="sd">            Si es la misma, no se hace nada y el proceso sigue igual, pero si es distinta se debe eliminar la anterior para que no se acumule basura en el servidor</span>
<span class="sd">            y después el proceso sigue igual.</span>
<span class="sd">            &#39;&#39;&#39;</span>

            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> Comprobación de la igualdad de la imagen </span><span class="se">\n\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-144'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-144'>#</a>
      </div>
      <p>Extraemos lo datos de la petición que se reciben aquí en el endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">respuesta</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;respuesta&#39;</span>
            <span class="k">print</span> <span class="n">respuesta</span><span class="o">.</span><span class="n">content</span>
            <span class="n">alumno</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">respuesta</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-145'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-145'>#</a>
      </div>
      <p>Para eso primero pasamos los datos de la base de datos del estudiante:
Lo único que modificamos es el método con el que se lama a la colección alumnos con el id de uno de ellos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;urlImagen&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">imagen</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Se trata de la misma imagen (NO SE HA CAMBIADO ESTA) no se hace nada </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;urlImagen&#39;</span><span class="p">)</span><span class="o">!=</span> <span class="s1">&#39;NULL&#39;</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Se trata de imágenes distintas, hay que mandar a borrar la antigua. </span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-146'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-146'>#</a>
      </div>
      <p>Se comprueba el dato recibido desde la base de datos con el pasado en la petición al endpoint.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="n">ManejadorImagenes</span><span class="o">.</span><span class="n">DeleteFile</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;urlImagen&#39;</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-147'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-147'>#</a>
      </div>
      <p>Mandamos a borrar la url de la imagen antingua del alumno.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span>

        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-148'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-148'>#</a>
      </div>
      <p>Ya que pùede que no tenga imagen antes y no hay que borrar nada.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-149'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-149'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-150'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-150'>#</a>
      </div>
      <p>return MensajeRespuesta(message="Todo OK man!")
Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-151'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-151'>#</a>
      </div>
      <p>Métodos de información sobre relaciones con otras entidades</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaProfesores</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/getProfesoresAlumno&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.getProfesoresAlumno&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getProfesoresAlumno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos completos de los profesores que dan clase al alumno de dni pasado</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/alumnos/getProfesoresAlumno?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-152'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-152'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getProfesoresAlumno en apigateway&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-153'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-153'>#</a>
      </div>
      <p>Transformación de la llamada al endpoints a la llamada a la api rest del servicio.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-154'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-154'>#</a>
      </div>
      <p>Conexión a un microservicio específico:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-155'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-155'>#</a>
      </div>
      <p>Le decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;alumnos/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/profesores&quot;</span>


        <span class="k">print</span> <span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-156'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-156'>#</a>
      </div>
      <p>Añadimos a la url la coleccion (alumnos), el recurso (alumno dado por su dni) y el recurso anidado de este (profesores)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-157'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-157'>#</a>
      </div>
      <p>Realizamos la petición</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">print</span> <span class="s2">&quot;IMPRESION DE LOS DATOS RECIBIDOS&quot;</span>
        <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaProfesores</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-158'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-158'>#</a>
      </div>
      <p>Vamos a intentar consumir los datos en JSON y convertirlos a un mensje enviable :)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">profesoresItems</span><span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-159'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-159'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">profesor</span> <span class="ow">in</span> <span class="n">listaProfesores</span><span class="p">:</span>
            <span class="n">profesoresItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Profesor</span><span class="p">(</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span> <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">)),</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-160'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-160'>#</a>
      </div>
      <p>Que rellenamos con todo los alumnos de la listaAlumnos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">ListaProfesores</span><span class="p">(</span><span class="n">profesores</span><span class="o">=</span><span class="n">profesoresItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-161'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-161'>#</a>
      </div>
      <p>Los adaptamos al tipo de mensaje y enviamos
return Greeting(message=str(result.content))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaAsignaturas</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/getAsignaturasAlumno&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.getAsignaturasAlumno&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAsignaturasAlumno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos completos de las asignatuas en las que está matriculado el alumno con dni pasado.</span>
<span class="sd">        Ejemplo de llamada:</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/alumnos/getAsignaturasAlumno?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getAsignaturasAlumno en apigateway&quot;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;alumnos/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/asignaturas&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAsignaturas</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">listaAsignaturas</span>
        <span class="n">asignaturasItems</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">asignatura</span> <span class="ow">in</span> <span class="n">listaAsignaturas</span><span class="p">:</span>
            <span class="n">asignaturasItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Asignatura</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asignatura</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">asignatura</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ListaAsignaturas</span><span class="p">(</span><span class="n">asignaturas</span><span class="o">=</span><span class="n">asignaturasItems</span><span class="p">)</span>

    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaClases</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;alumnos/getClasesAlumno&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alumnos.getClasesAlumno&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getClasesAlumno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos completos de las clases en las que está matriculado el alumno con dni pasado.</span>
<span class="sd">        Ejemplo de llamada:</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/alumnos/getClasesAlumno?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getCursosAlumno en apigateway&quot;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;alumnos/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/clases&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaClases</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">listaClases</span>
        <span class="n">clasesItems</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">clase</span> <span class="ow">in</span> <span class="n">listaClases</span><span class="p">:</span>
            <span class="n">clasesItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Clase</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span><span class="n">curso</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;curso&#39;</span><span class="p">)),</span><span class="n">grupo</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grupo&#39;</span><span class="p">)),</span><span class="n">nivel</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nivel&#39;</span><span class="p">))))</span>
        <span class="k">return</span> <span class="n">ListaClases</span><span class="p">(</span><span class="n">clases</span><span class="o">=</span><span class="n">clasesItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-162'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-162'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-163'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-163'>#</a>
      </div>
      <h6></h6>
<p>métodos de PROFESORES                    #</p>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">message_types</span><span class="o">.</span><span class="n">VoidMessage</span><span class="p">,</span> <span class="n">ListaProfesores</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;profesores/getProfesores&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profesores.getProfesores&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getProfesores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con todos los profesores registrados en el sistema, de forma simplificada (solo nombre y ID)</span>

<span class="sd">        Llamada desde terminal:</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/profesores/getProfesores</span>
<span class="sd">        Llamada desde JavaScript:</span>
<span class="sd">        response =service.profesores.getProfesores().execute()</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-164'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-164'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-165'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-165'>#</a>
      </div>
      <p>Identificación del módulo en el que estamos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-166'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-166'>#</a>
      </div>
      <p>Leclear decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;profesores&quot;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-167'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-167'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaProfesores</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-168'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-168'>#</a>
      </div>
      <p>Al no especificar nada se llama al método GET de la URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">profesoresItems</span><span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-169'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-169'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">profesor</span> <span class="ow">in</span> <span class="n">listaProfesores</span><span class="p">:</span>
            <span class="n">profesoresItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Profesor</span><span class="p">(</span> <span class="n">nombre</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span> <span class="n">apellidos</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">)),</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>  <span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-170'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-170'>#</a>
      </div>
      <p>Que rellenamos con todo los profesores de la listaProfesores</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">ListaProfesores</span><span class="p">(</span><span class="n">profesores</span><span class="o">=</span><span class="n">profesoresItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-171'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-171'>#</a>
      </div>
      <p>Los adaptamos al tipo de mensaje y enviamos
return Greeting(message=str(result.content))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ProfesorCompleto</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;profesores/getProfesor&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profesores.getProfesor&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getProfesor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve toda la información de un profesor en caso de estar en el sistema.</span>

<span class="sd">        Llamada ejemplo desde terminal:</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/profesores/getProfesor?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-172'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-172'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s1">&#39; Petición GET a profesores.getProfesor&#39;</span>
            <span class="k">print</span> <span class="s1">&#39; Request: </span><span class="se">\n</span><span class="s1"> &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-173'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-173'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-174'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-174'>#</a>
      </div>
      <p>Cuando se llama a este recurso lo que se quiere es recibir toda la información
de una entidad Alumno, para ello primero vamos a recuperar la información del microsrevicio apropiado:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-175'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-175'>#</a>
      </div>
      <p>Conexión a un microservicio específico:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Según la doc. de urlfetch (ver arriba) no podemos pasar parámetros con el payload, así que como conocemos</span>
<span class="sd">        la api del microservicios al que vamos a llamr realizamos la petición bajo su especificacion, según la cual</span>
<span class="sd">        solo tenemos que llamar a /alumnos/&lt;id_alumno&gt; entonces concatenamos a la url esa id qu recibimos en la llamada</span>
<span class="sd">        a este procedimiento.</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-176'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-176'>#</a>
      </div>
      <p>Le decimos al microservicio que queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;profesores/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-177'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-177'>#</a>
      </div>
      <p>Recursos más entidad</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>

        <span class="k">print</span> <span class="s2">&quot;RESULTADO:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-178'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-178'>#</a>
      </div>
      <p>Petición al microservicio</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;400&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;404&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">NotFoundException</span><span class="p">(</span><span class="s1">&#39;Profesor con ID </span><span class="si">%s</span><span class="s1"> no encontrado.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="n">profesor</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-179'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-179'>#</a>
      </div>
      <p>print result.content</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Código de estado: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-180'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-180'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">profesor</span> <span class="o">=</span> <span class="n">ProfesorCompleto</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span>
                                <span class="n">nombre</span><span class="o">=</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">),</span>
                                <span class="n">apellidos</span><span class="o">=</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">),</span>
                                <span class="n">dni</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dni&#39;</span><span class="p">)),</span>
                                <span class="n">direccion</span><span class="o">=</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;direccion&#39;</span><span class="p">),</span>
                                <span class="n">localidad</span><span class="o">=</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;localidad&#39;</span><span class="p">),</span>
                                <span class="n">provincia</span><span class="o">=</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;provincia&#39;</span><span class="p">),</span>
                                <span class="n">fecha_nacimiento</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fecha_nacimiento&#39;</span><span class="p">)),</span>
                                <span class="n">telefono</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;telefono&#39;</span><span class="p">))</span>
                                <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-181'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-181'>#</a>
      </div>
      <p>Componemos un mensaje de tipo AlumnoCompleto.
Las partes que son enteros las pasamos a string para enviarlos como mensajes de tipo string.
Los campos que tengan NULL en la bd no se pasan al tipo message y ese campo queda vaćio y no se muestra.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s1">&#39; Return: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">profesor</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-182'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-182'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ProfesorCompleto</span><span class="p">,</span> <span class="n">StatusID</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;profesores/insertarProfesor&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profesores.insertarProfesor&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">insertarProfesor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Introduce un nuevo profesor en el sistema.</span>

<span class="sd">        Ejemplo de llamada en terminal:</span>
<span class="sd">        curl -i -d &quot;nombre=Juan&amp;apellidos=Azustregui&amp;dni=99&amp;direccion=Calle&amp;localidad=Jerezfrontera&amp;provincia=Granada&amp;fecha_nacimiento=1988-2-6&amp;telefono=699164459&quot; -X POST -G localhost:8001/_ah/api/helloworld/v1/profesores/insertarProfesor</span>


<span class="sd">        (-i para ver las cabeceras)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a profesores.insertarProfesor&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-183'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-183'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-184'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-184'>#</a>
      </div>
      <p>Si no tenemos todos los atributos entonces enviamos un error de bad request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-185'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-185'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;profesores&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-186'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-186'>#</a>
      </div>
      <p>Añadimos el servicio al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;nombre&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="p">,</span>
          <span class="s2">&quot;apellidos&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="p">,</span>
          <span class="s2">&quot;dni&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="p">,</span>
          <span class="s2">&quot;direccion&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="p">,</span>
          <span class="s2">&quot;localidad&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="p">,</span>
          <span class="s2">&quot;provincia&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="p">,</span>
          <span class="s2">&quot;fecha_nacimiento&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="p">,</span>
          <span class="s2">&quot;telefono&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-187'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-187'>#</a>
      </div>
      <p>Extraemos lo datos de la petición al endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-188'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-188'>#</a>
      </div>
      <h1>Doc de urlfetch: https://cloud.google.com/appengine/docs/python/refdocs/google.appengine.api.urlfetch</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-189'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-189'>#</a>
      </div>
      <p>Realizamos la petición al servicio con los datos pasados al endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición de profesores.insertarProfesor&quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-190'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-190'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">json</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;404&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">NotFoundException</span><span class="p">(</span><span class="s1">&#39;Alumno con ID </span><span class="si">%s</span><span class="s1"> ya existe en el sistema.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-191'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-191'>#</a>
      </div>
      <p>print str(result.content['status'])</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">StatusID</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span> <span class="nb">id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;idProfesor&#39;</span><span class="p">]),</span> <span class="n">statusCode</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-192'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-192'>#</a>
      </div>
      <p>return MensajeRespuesta(message="Todo OK man!")
Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;profesores/delProfesor&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profesores.delProfesor&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delProfesor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        delProfesor()</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        Ubuntu&gt; curl -d &quot;dni=1&quot; -X DELETE -G localhost:8001/_ah/api/helloworld/v1/profesores/delProfesor</span>
<span class="sd">        {</span>
<span class="sd">         &quot;message&quot;: &quot;OK&quot;</span>
<span class="sd">        }</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        Ubuntu&gt; curl -d &quot;dni=1&quot; -X DELETE -G localhost:8001/_ah/api/hellworld/v1/profesor/delProfesor</span>
<span class="sd">        {</span>
<span class="sd">         &quot;message&quot;: &quot;Elemento no encontrado&quot;</span>
<span class="sd">        }</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición al método profesores.delProfesor de APIGateway&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-193'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-193'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-194'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-194'>#</a>
      </div>
      <p>Ejemplo de borrado de un recurso pasando el id de un profesor</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;alumnos/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-195'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-195'>#</a>
      </div>
      <p>Ejemplo de ejecución en el caso de no encontrar el recurso:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">DELETE</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-196'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-196'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-197'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-197'>#</a>
      </div>
      <p>Extraemos el argumento id de la petición y la añadimos a la URL</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-198'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-198'>#</a>
      </div>
      <p>Realizamos la petición a la url del servicio con el método apropiado.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ProfesorCompleto</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;profesores/modProfesorCompleto&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profesores.modProfesorCompleto&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">modificarProfesorCompleto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Modifica todos los atributos de un profesor, aunque algunos queden igual.</span>
<span class="sd">        curl -d &quot;id=1&amp;nombre=Pedro&amp;apellidos=Torrssr&amp;dni=23&amp;direccion=CREalCartuja&amp;localidad=Granada&amp;provincia=Granada&amp;fecha_nacimiento=1988-12-4&amp;telefono=23287282&quot; -i -X POST -G localhost:8001/_ah/api/helloworld/v1/profesores/modProfesorCompleto</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a alumnos.modAlumnoCompleto&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-199'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-199'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;profesores/&quot;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-200'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-200'>#</a>
      </div>
      <p>Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;nombre&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="p">,</span>
          <span class="s2">&quot;apellidos&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">apellidos</span><span class="p">,</span>
          <span class="s2">&quot;dni&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">dni</span><span class="p">,</span>
          <span class="s2">&quot;direccion&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">direccion</span><span class="p">,</span>
          <span class="s2">&quot;localidad&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">localidad</span><span class="p">,</span>
          <span class="s2">&quot;provincia&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">provincia</span><span class="p">,</span>
          <span class="s2">&quot;fecha_nacimiento&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">fecha_nacimiento</span><span class="p">,</span>
          <span class="s2">&quot;telefono&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">telefono</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span>

        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-201'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-201'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-202'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-202'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos, colección alumnos / alumno con id concreto.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-203'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-203'>#</a>
      </div>
      <p>Extraemos lo datos de la petición que se reciben aquí en el endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-204'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-204'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaAlumnos</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;profesores/getAlumnosProfesor&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profesores.getAlumnosProfesor&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAlumnosProfesores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos resumidos de los alumnos a los que el profesor con id pasado da clase.</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/profesores/getAlumnosProfesor?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-205'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-205'>#</a>
      </div>
      <p>return MensajeRespuesta(message="Todo OK man!")
Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getAlumnosProfesor en apigateway&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-206'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-206'>#</a>
      </div>
      <p>Métodos de relación con otras entidades.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-207'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-207'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-208'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-208'>#</a>
      </div>
      <p>Transformación de la llamada al endpoints a la llamada a la api rest del servicio.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;profesores/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/alumnos&quot;</span>


        <span class="k">print</span> <span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-209'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-209'>#</a>
      </div>
      <p>Conexión a un microservicio específico:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-210'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-210'>#</a>
      </div>
      <p>Le decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">print</span> <span class="s2">&quot;IMPRESION DE LOS DATOS RECIBIDOS&quot;</span>
        <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAlumnos</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-211'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-211'>#</a>
      </div>
      <p>Añadimos a la url la coleccion (alumnos), el recurso (alumno dado por su dni) y el recurso anidado de este (profesores)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">vectorAlumnos</span><span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-212'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-212'>#</a>
      </div>
      <p>Realizamos la petición</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">alumno</span> <span class="ow">in</span> <span class="n">listaAlumnos</span><span class="p">:</span>
            <span class="n">vectorAlumnos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Alumno</span><span class="p">(</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span> <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">)),</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-213'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-213'>#</a>
      </div>
      <p>Vamos a intentar consumir los datos en JSON y convertirlos a un mensje enviable :)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">ListaAlumnos</span><span class="p">(</span><span class="n">alumnos</span><span class="o">=</span><span class="n">vectorAlumnos</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-214'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-214'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaAsignaturas</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;profesores/getAsignaturasProfesor&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profesores.getAsignaturasProfesor&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAsignaturasProfesor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos completos de las asignatuas que el profesor en cuestión imparte.</span>
<span class="sd">        Ejemplo de llamada:</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/profesores/getAsignaturasProfesor?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getAsignaturasProfesor en apigateway&quot;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;profesores/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/asignaturas&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAsignaturas</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">listaAsignaturas</span>
        <span class="n">asignaturasItems</span><span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">asignatura</span> <span class="ow">in</span> <span class="n">listaAsignaturas</span><span class="p">:</span>
            <span class="n">asignaturasItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Asignatura</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asignatura</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">asignatura</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ListaAsignaturas</span><span class="p">(</span><span class="n">asignaturas</span><span class="o">=</span><span class="n">asignaturasItems</span><span class="p">)</span>

    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaClases</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;profesores/getClasesProfesor&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profesores.getClasesProfesor&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getClasesProfesor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos minimos de las clases a las que ese profesor imparte.</span>
<span class="sd">        Ejemplo de llamada:</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/profesores/getClasesProfesor?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getClasesProfesor en apigateway&quot;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;profesores/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/clases&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaClases</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">listaClases</span>
        <span class="n">clasesItems</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">clase</span> <span class="ow">in</span> <span class="n">listaClases</span><span class="p">:</span>
            <span class="n">clasesItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Clase</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span><span class="n">curso</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;curso&#39;</span><span class="p">)),</span><span class="n">grupo</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grupo&#39;</span><span class="p">)),</span><span class="n">nivel</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nivel&#39;</span><span class="p">))))</span>
        <span class="k">return</span> <span class="n">ListaClases</span><span class="p">(</span><span class="n">clases</span><span class="o">=</span><span class="n">clasesItems</span><span class="p">)</span>

    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaAsociaciones</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;profesores/getAsociacionesProfesor&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profesores.getAsociacionesProfesor&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAsociacionesProfesor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con las asociaciones a las que un profesor imparte clase</span>
<span class="sd">        Ejemplo de llamada:</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/profesores/getAsociacionesProfesor?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-215'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-215'>#</a>
      </div>
      <p>Que rellenamos con todo los alumnos de la listaAlumnos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot; Petición GET a profesores.getAsociacionesProfesor&quot;</span>
            <span class="k">print</span> <span class="s2">&quot; request: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;profesores/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/asociaciones&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39; RESULTADO de la petición&#39;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAsociaciones</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;lista asociaciones&#39;</span>
            <span class="k">print</span> <span class="n">listaAsociaciones</span>

        <span class="n">vectorAsociaciones</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">asociacion</span> <span class="ow">in</span> <span class="n">listaAsociaciones</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;asociacion&#39;</span>
            <span class="k">print</span> <span class="n">asociacion</span>
            <span class="n">vectorAsociaciones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Asociacion</span><span class="p">(</span><span class="n">id_asociacion</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asociacion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span>
                                                 <span class="n">id_clase</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asociacion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;idClase&#39;</span><span class="p">)),</span>
                                                 <span class="n">id_asignatura</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asociacion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;idAsignatura&#39;</span><span class="p">)),</span>
                                                 <span class="n">nombreAsignatura</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asociacion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombreAsignatura&#39;</span><span class="p">)),</span>
                                                 <span class="n">nombreClase</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asociacion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombreClase&#39;</span><span class="p">))</span>
                                                 <span class="p">))</span>
        <span class="k">return</span> <span class="n">ListaAsociaciones</span><span class="p">(</span><span class="n">asociaciones</span><span class="o">=</span><span class="n">vectorAsociaciones</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-216'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-216'>#</a>
      </div>
      <p>Los adaptamos al tipo de mensaje y enviamos
return Greeting(message=str(result.content))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-217'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-217'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">message_types</span><span class="o">.</span><span class="n">VoidMessage</span><span class="p">,</span> <span class="n">ListaAsignaturas</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;asignaturas/getAsignaturas&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asignaturas.getAsignaturas&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAsignaturas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con todos las asignaturas registrados en el sistema, de forma simplificada (solo nombre y ID)</span>

<span class="sd">        Llamada desde terminal:</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/asignaturas/getAsignaturas</span>
<span class="sd">        Llamada desde JavaScript:</span>
<span class="sd">        response = service.asignaturas.getAsignaturas().execute()</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-218'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-218'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-219'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-219'>#</a>
      </div>
      <h6></h6>
<p>métodos de ASIGNATURAS                   #</p>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-220'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-220'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;asignaturas&quot;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-221'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-221'>#</a>
      </div>
      <p>Identificación del módulo en el que estamos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAsignaturas</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-222'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-222'>#</a>
      </div>
      <p>Leclear decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">asignaturasItems</span><span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-223'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-223'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">asignatura</span> <span class="ow">in</span> <span class="n">listaAsignaturas</span><span class="p">:</span>
            <span class="n">asignaturasItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Asignatura</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asignatura</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">asignatura</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">))</span> <span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-224'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-224'>#</a>
      </div>
      <p>Al no especificar nada se llama al método GET de la URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">ListaAsignaturas</span><span class="p">(</span><span class="n">asignaturas</span><span class="o">=</span><span class="n">asignaturasItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-225'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-225'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">AsignaturaCompleta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;asignaturas/getAsignatura&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asignaturas.getAsignatura&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAsignatura</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve toda la información de un profesor en caso de estar en el sistema.</span>

<span class="sd">        Llamada ejemplo desde terminal:</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/asignaturas/getAsignatura?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-226'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-226'>#</a>
      </div>
      <p>Que rellenamos con todo los asignaturas de la listaProfesores</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición GET a asignaturas.getAsignatura&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;request: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-227'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-227'>#</a>
      </div>
      <p>Los adaptamos al tipo de mensaje y enviamos
return Greeting(message=str(result.content))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-228'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-228'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-229'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-229'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;asignaturas/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-230'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-230'>#</a>
      </div>
      <p>Conexión a un microservicio específico:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>

        <span class="k">print</span> <span class="s2">&quot;RESULTADO:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-231'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-231'>#</a>
      </div>
      <p>Le decimos al microservicio que queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;400&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;404&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">NotFoundException</span><span class="p">(</span><span class="s1">&#39;Profesor con ID </span><span class="si">%s</span><span class="s1"> no encontrado.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="n">profesor</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-232'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-232'>#</a>
      </div>
      <p>Recursos más entidad</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Código de estado: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-233'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-233'>#</a>
      </div>
      <p>Petición al microservicio</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">asignatura</span> <span class="o">=</span> <span class="n">AsignaturaCompleta</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span>
                                <span class="n">nombre</span><span class="o">=</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)</span>
                                <span class="p">)</span>

        <span class="k">return</span> <span class="n">asignatura</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-234'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-234'>#</a>
      </div>
      <p>print result.content</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">AsignaturaCompleta</span><span class="p">,</span> <span class="n">StatusID</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;asignaturas/insertarAsignatura&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asignaturas.insertarAsignatura&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">insertarAsignatura</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Introduce un nuevo profesor en el sistema.</span>

<span class="sd">        Ejemplo de llamada en terminal:</span>
<span class="sd">        curl -i -d &quot;nombre=CienciasExperimentales&quot; -X POST -G localhost:8001/_ah/api/helloworld/v1/asignaturas/insertarAsignatura</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a asignaturas.insertarAsignatura&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-235'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-235'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-236'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-236'>#</a>
      </div>
      <p>Componemos un mensaje de tipo AlumnoCompleto.
Las partes que son enteros las pasamos a string para enviarlos como mensajes de tipo string.
Los campos que tengan NULL en la bd no se pasan al tipo message y ese campo queda vaćio y no se muestra.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-237'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-237'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;asignaturas&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-238'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-238'>#</a>
      </div>
      <p>Si no tenemos todos los atributos entonces enviamos un error de bad request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;nombre&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;form_fields:&#39;</span>
            <span class="k">print</span> <span class="n">form_fields</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-239'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-239'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-240'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-240'>#</a>
      </div>
      <p>Añadimos el servicio al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-241'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-241'>#</a>
      </div>
      <p>Extraemos lo datos de la petición al endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>


        <span class="n">json</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-242'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-242'>#</a>
      </div>
      <h1>Doc de urlfetch: https://cloud.google.com/appengine/docs/python/refdocs/google.appengine.api.urlfetch</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">StatusID</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span> <span class="nb">id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;idAsignatura&#39;</span><span class="p">]),</span> <span class="n">statusCode</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-243'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-243'>#</a>
      </div>
      <p>Realizamos la petición al servicio con los datos pasados al endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;asignaturas/delAsignatura&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asignaturas.delAsignatura&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delAsignatura</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        delProfesor()</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        Ubuntu&gt; curl -d &quot;id=1&quot; -X DELETE -G localhost:8001/_ah/api/helloworld/v1/asignaturas/delAsignatura</span>
<span class="sd">        {</span>
<span class="sd">         &quot;message&quot;: &quot;OK&quot;</span>
<span class="sd">        }</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        Ubuntu&gt; curl -d &quot;dni=1&quot; -X DELETE -G localhost:8001/_ah/api/hellworld/v1/asignaturas/delAsignatura</span>
<span class="sd">        {</span>
<span class="sd">         &quot;message&quot;: &quot;Elemento no encontrado&quot;</span>
<span class="sd">        }</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición al método asignaturas.delAsignatura de APIGateway&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-244'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-244'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-245'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-245'>#</a>
      </div>
      <p>return MensajeRespuesta(message="Todo OK man!")
Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;asignaturas/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-246'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-246'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">DELETE</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-247'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-247'>#</a>
      </div>
      <p>Ejemplo de borrado de un recurso pasando el id de un profesor</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-248'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-248'>#</a>
      </div>
      <p>Ejemplo de ejecución en el caso de no encontrar el recurso:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-249'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-249'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">AsignaturaCompleta</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;asignaturas/modAsignaturaCompleta&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asignaturas.modAsignaturaCompleta&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">modificarAsignaturaCompleta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Modifica todos los atributos de una asignatura, aunque algunos queden igual.</span>
<span class="sd">        curl -d &quot;id=1&amp;nombre=Chinorri&quot; -i -X POST -G localhost:8001/_ah/api/helloworld/v1/asignaturas/modAsignaturaCompleta</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a asignaturas.modAsignaturaCompleta&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-250'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-250'>#</a>
      </div>
      <p>Extraemos el argumento id de la petición y la añadimos a la URL</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;asignaturas/&quot;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-251'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-251'>#</a>
      </div>
      <p>Realizamos la petición a la url del servicio con el método apropiado DELETE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;nombre&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span>

        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-252'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-252'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-253'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-253'>#</a>
      </div>
      <p>Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-254'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-254'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaAlumnos</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;asignaturas/getAlumnosAsignatura&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asignaturas.getAlumnosAsignatura&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAlumnosAsignatura</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos resumidos de los alumnos que esta matriculados en esa clase</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/asignaturas/getAlumnosAsignatura?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-255'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-255'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos, colección alumnos / alumno con id concreto.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getAlumnosAsignatura en apigateway&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-256'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-256'>#</a>
      </div>
      <p>Extraemos lo datos de la petición que se reciben aquí en el endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-257'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-257'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-258'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-258'>#</a>
      </div>
      <p>Métodos de relaciones con otras entidades</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;asignaturas/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/alumnos&quot;</span>


        <span class="k">print</span> <span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-259'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-259'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-260'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-260'>#</a>
      </div>
      <p>Transformación de la llamada al endpoints a la llamada a la api rest del servicio.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">print</span> <span class="s2">&quot;IMPRESION DE LOS DATOS RECIBIDOS&quot;</span>
        <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAlumnos</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-261'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-261'>#</a>
      </div>
      <p>Conexión a un microservicio específico:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">vectorAlumnos</span><span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-262'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-262'>#</a>
      </div>
      <p>Le decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">alumno</span> <span class="ow">in</span> <span class="n">listaAlumnos</span><span class="p">:</span>
            <span class="n">vectorAlumnos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Alumno</span><span class="p">(</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span>
                                         <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">)),</span>
                                         <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>
                                         <span class="p">)</span>
                                <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-263'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-263'>#</a>
      </div>
      <p>Añadimos a la url la coleccion (alumnos), el recurso (alumno dado por su dni) y el recurso anidado de este (profesores)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">ListaAlumnos</span><span class="p">(</span><span class="n">alumnos</span><span class="o">=</span><span class="n">vectorAlumnos</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-264'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-264'>#</a>
      </div>
      <p>Realizamos la petición</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaProfesores</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;asignaturas/getProfesoresAsignatura&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asignaturas.getProfesoresAsignatura&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getProfesoresAsignatura</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos simplificados de los profesores que imparten clase en una asignatura.</span>
<span class="sd">        Ejemplo de llamada:</span>
<span class="sd">        &gt; curl -i -X GET localhost:8001/_ah/api/helloworld/v1/asignaturas/getProfesoresAsignatura?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getProfesoresAsignatura en apigateway&quot;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;asignaturas/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/profesores&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaProfesores</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">listaProfesores</span>
        <span class="n">profesoresItems</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">profesor</span> <span class="ow">in</span> <span class="n">listaProfesores</span><span class="p">:</span>
            <span class="n">profesoresItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Profesor</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">nombre</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span> <span class="n">apellidos</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ListaProfesores</span><span class="p">(</span><span class="n">profesores</span><span class="o">=</span><span class="n">profesoresItems</span><span class="p">)</span>

    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaClases</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;asignaturas/getClasesAsignatura&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asignaturas.getClasesAsignatura&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getClasesAsignatura</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos minimos de las clases en las que se imparte esa asignatura</span>
<span class="sd">        Ejemplo de llamada:</span>
<span class="sd">        &gt; curl -i -X GET localhost:8001/_ah/api/helloworld/v1/asignaturas/getClasesAsignatura?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getClasesProfesor en apigateway&quot;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;asignaturas/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/clases&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">url</span>
            <span class="k">print</span> <span class="s2">&quot;Respuesta del microservicio: </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">listaClases</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">listaClases</span>
        <span class="n">clasesItems</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">clase</span> <span class="ow">in</span> <span class="n">listaClases</span><span class="p">:</span>
            <span class="n">clasesItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Clase</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span><span class="n">curso</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;curso&#39;</span><span class="p">)),</span><span class="n">grupo</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grupo&#39;</span><span class="p">)),</span><span class="n">nivel</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nivel&#39;</span><span class="p">))))</span>
        <span class="k">return</span> <span class="n">ListaClases</span><span class="p">(</span><span class="n">clases</span><span class="o">=</span><span class="n">clasesItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-265'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-265'>#</a>
      </div>
      <p>Vamos a intentar consumir los datos en JSON y convertirlos a un mensje enviable :)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-266'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-266'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">message_types</span><span class="o">.</span><span class="n">VoidMessage</span><span class="p">,</span> <span class="n">ListaClases</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;clases/getClases&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clases.getClases&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getClases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con todos las clases registrados en el sistema, de forma simplificada, id_clase, curso, grupo y nivel</span>

<span class="sd">        Llamada desde terminal:</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/clases/getClases</span>
<span class="sd">        Llamada desde JavaScript:</span>
<span class="sd">        response = service.clases.getClases().execute()</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-267'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-267'>#</a>
      </div>
      <p>Que rellenamos con todo los alumnos de la listaAlumnos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-268'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-268'>#</a>
      </div>
      <p>Los adaptamos al tipo de mensaje y enviamos
return Greeting(message=str(result.content))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-269'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-269'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;clases&quot;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-270'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-270'>#</a>
      </div>
      <h6></h6>
<p>métodos de CLASES                        #</p>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaClases</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-271'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-271'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">clasesItems</span><span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-272'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-272'>#</a>
      </div>
      <p>Identificación del módulo en el que estamos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">clase</span> <span class="ow">in</span> <span class="n">listaClases</span><span class="p">:</span>
            <span class="n">clasesItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Clase</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">curso</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;curso&#39;</span><span class="p">)),</span> <span class="n">grupo</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grupo&#39;</span><span class="p">)),</span> <span class="n">nivel</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nivel&#39;</span><span class="p">))</span> <span class="p">))</span>

        <span class="k">return</span> <span class="n">ListaClases</span><span class="p">(</span><span class="n">clases</span><span class="o">=</span><span class="n">clasesItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-273'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-273'>#</a>
      </div>
      <p>Leclear decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ClaseCompleta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;clases/getClase&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clases.getClase&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getClase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve toda la información de una clase en caso de estar en el sistema.</span>

<span class="sd">        Llamada ejemplo desde terminal:</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/clases/getClase?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-274'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-274'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición GET a clases.getClase&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;request: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-275'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-275'>#</a>
      </div>
      <p>Al no especificar nada se llama al método GET de la URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-276'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-276'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-277'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-277'>#</a>
      </div>
      <p>Que rellenamos con todo los asignaturas de la listaProfesores</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;clases/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-278'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-278'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>

        <span class="k">print</span> <span class="s2">&quot;RESULTADO:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-279'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-279'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;400&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;404&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">NotFoundException</span><span class="p">(</span><span class="s1">&#39;Clase con ID </span><span class="si">%s</span><span class="s1"> no encontrada.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="n">clase</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-280'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-280'>#</a>
      </div>
      <p>Conexión a un microservicio específico:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Código de estado: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-281'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-281'>#</a>
      </div>
      <p>Le decimos al microservicio que queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">clase</span> <span class="o">=</span> <span class="n">ClaseCompleta</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">curso</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;curso&#39;</span><span class="p">)),</span> <span class="n">grupo</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grupo&#39;</span><span class="p">)),</span> <span class="n">nivel</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">clase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nivel&#39;</span><span class="p">))</span> <span class="p">)</span>


        <span class="k">return</span> <span class="n">clase</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-282'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-282'>#</a>
      </div>
      <p>Recursos más entidad</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ClaseCompleta</span><span class="p">,</span> <span class="n">StatusID</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;clases/insertarClase&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clases.insertarClase&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">insertarClase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Introduce una nueva clase en el sistema.</span>

<span class="sd">        Ejemplo de llamada en terminal:</span>
<span class="sd">        curl -i -d &quot;curso=4&amp;grupo=B&amp;nivel=Primaria&quot; -X POST -G localhost:8001/_ah/api/helloworld/v1/clases/insertarClase</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a clases.insertarClase&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-283'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-283'>#</a>
      </div>
      <p>Petición al microservicio</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">curso</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">grupo</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">nivel</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-284'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-284'>#</a>
      </div>
      <p>print result.content</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-285'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-285'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;clases&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-286'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-286'>#</a>
      </div>
      <p>Componemos un mensaje de tipo AlumnoCompleto.
Las partes que son enteros las pasamos a string para enviarlos como mensajes de tipo string.
Los campos que tengan NULL en la bd no se pasan al tipo message y ese campo queda vaćio y no se muestra.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;curso&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">curso</span><span class="p">,</span>
          <span class="s2">&quot;grupo&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">grupo</span><span class="p">,</span>
          <span class="s2">&quot;nivel&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">nivel</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-287'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-287'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-288'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-288'>#</a>
      </div>
      <p>Si no tenemos todos los atributos entonces enviamos un error de bad request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-289'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-289'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>


        <span class="n">json</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-290'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-290'>#</a>
      </div>
      <p>Añadimos el servicio al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">StatusID</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span> <span class="nb">id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;idClase&#39;</span><span class="p">]),</span> <span class="n">statusCode</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-291'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-291'>#</a>
      </div>
      <p>Extraemos lo datos de la petición al endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;clases/delClase&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clases.delClase&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delClase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Elimina la clase con id pasado en caso de existir en el sistema.</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        Ubuntu&gt; curl -d &quot;id=1&quot; -X DELETE -G localhost:8001/_ah/api/helloworld/v1/clases/delClase</span>
<span class="sd">        {</span>
<span class="sd">         &quot;message&quot;: &quot;OK&quot;</span>
<span class="sd">        }</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición al método clases.delClase de APIGateway&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-292'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-292'>#</a>
      </div>
      <h1>Doc de urlfetch: https://cloud.google.com/appengine/docs/python/refdocs/google.appengine.api.urlfetch</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-293'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-293'>#</a>
      </div>
      <p>Realizamos la petición al servicio con los datos pasados al endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;clases/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-294'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-294'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">DELETE</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-295'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-295'>#</a>
      </div>
      <p>Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-296'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-296'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-297'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-297'>#</a>
      </div>
      <p>Ejemplo de borrado de un recurso pasando el id de la clase.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ClaseCompleta</span><span class="p">,</span> <span class="n">MensajeRespuesta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;clases/modClaseCompleta&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clases.modClaseCompleta&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">modificarClaseCompleta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Modifica todos los atributos de una clase, aunque algunos queden igual.</span>
<span class="sd">        curl -d &quot;id=1&amp;curso=1&amp;grupo=B&amp;nivel=BACH&quot; -i -X POST -G localhost:8001/_ah/api/helloworld/v1/clases/modClaseCompleta</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a clases.modClaseCompleta&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span>  <span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">curso</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">grupo</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">nivel</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-298'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-298'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;clases/&quot;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-299'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-299'>#</a>
      </div>
      <p>Extraemos el argumento id de la petición y la añadimos a la URL</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;curso&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">curso</span><span class="p">,</span>
          <span class="s2">&quot;grupo&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">grupo</span><span class="p">,</span>
          <span class="s2">&quot;nivel&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">nivel</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span>

        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-300'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-300'>#</a>
      </div>
      <p>Realizamos la petición a la url del servicio con el método apropiado DELETE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-301'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-301'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-302'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-302'>#</a>
      </div>
      <p>Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaAlumnos</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;clases/getAlumnosClase&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clases.getAlumnosClase&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAlumnosClase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos resumidos de los alumnos que esta matriculados en esa clase</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/clases/getAlumnosClase?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-303'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-303'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getAlumnosClase en apigateway&quot;</span><span class="p">)</span>

        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;clases/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/alumnos&quot;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-304'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-304'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos, colección alumnos / alumno con id concreto.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;IMPRESION DE LOS DATOS RECIBIDOS&quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAlumnos</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">vectorAlumnos</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">alumno</span> <span class="ow">in</span> <span class="n">listaAlumnos</span><span class="p">:</span>
            <span class="n">vectorAlumnos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Alumno</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span> <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">))))</span>
        <span class="k">return</span> <span class="n">ListaAlumnos</span><span class="p">(</span><span class="n">alumnos</span><span class="o">=</span><span class="n">vectorAlumnos</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-305'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-305'>#</a>
      </div>
      <p>Extraemos lo datos de la petición que se reciben aquí en el endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaProfesores</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;clases/getProfesoresClase&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clases.getProfesoresClase&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getProfesoresClase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos simplificados de los profesores que imparten alguna asignatura a esa clase.</span>
<span class="sd">        Ejemplo de llamada:</span>
<span class="sd">        curl -i -X GET localhost:8001/_ah/api/helloworld/v1/clases/getProfesoresClase?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getProfesoresAsignatura en apigateway&quot;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;clases/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/profesores&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaProfesores</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">listaProfesores</span>
        <span class="n">profesoresItems</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">profesor</span> <span class="ow">in</span> <span class="n">listaProfesores</span><span class="p">:</span>
            <span class="n">profesoresItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Profesor</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span> <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ListaProfesores</span><span class="p">(</span><span class="n">profesores</span><span class="o">=</span><span class="n">profesoresItems</span><span class="p">)</span>

    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaAsignaturas</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;clases/getAsignaturasClase&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clases.getAsignaturasClase&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAsignaturasClase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con los datos mínimos de las asignaturas que se imparten en una clase.</span>
<span class="sd">        Ejemplo de llamada:</span>
<span class="sd">        &gt; curl -i -X GET localhost:8001/_ah/api/helloworld/v1/clases/getAsignaturasClase?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getAsignaturasProfesor en apigateway&quot;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;clases/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/asignaturas&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAsignaturas</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">listaAsignaturas</span>
        <span class="n">asignaturasItems</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">asignatura</span> <span class="ow">in</span> <span class="n">listaAsignaturas</span><span class="p">:</span>
            <span class="n">asignaturasItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Asignatura</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asignatura</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">asignatura</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ListaAsignaturas</span><span class="p">(</span><span class="n">asignaturas</span><span class="o">=</span><span class="n">asignaturasItems</span><span class="p">)</span>

    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaAsociaciones</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;clases/getAsociacionesClase&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clases.getAsociacionesClase&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAsociacionesClase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            curl -i -X GET localhost:8001/_ah/api/helloworld/v1/clases/getAsociacionesClase?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Ejecución de getAsociacionesClase en apigateway&quot;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;clases/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/asociaciones&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAsociaciones</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">listaAsociaciones</span>
        <span class="n">listaAS</span><span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">listaAsociaciones</span><span class="p">:</span>
            <span class="n">listaAS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Asociacion</span><span class="p">(</span> <span class="n">id_asociacion</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">id_clase</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;idClase&#39;</span><span class="p">)),</span> <span class="n">id_asignatura</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;idAsignatura&#39;</span><span class="p">)),</span> <span class="n">nombreAsignatura</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombreAsignatura&#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ListaAsociaciones</span><span class="p">(</span><span class="n">asociaciones</span><span class="o">=</span><span class="n">listaAS</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-306'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-306'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-307'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-307'>#</a>
      </div>
      <p>Métodos de relaciones con otras entidades</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">message_types</span><span class="o">.</span><span class="n">VoidMessage</span><span class="p">,</span> <span class="n">ListaMatriculas</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;matriculas/getMatriculas&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;matriculas.getMatriculas&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getMatriculas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con todos las matriculas registrados en el sistema.</span>

<span class="sd">        Llamada desde terminal:</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/matriculas/getMatriculas</span>
<span class="sd">        Llamada desde JavaScript:</span>
<span class="sd">        response = service.matriculas.getMatriculas().execute()</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-308'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-308'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-309'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-309'>#</a>
      </div>
      <p>Transformación de la llamada al endpoints a la llamada a la api rest del servicio.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-310'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-310'>#</a>
      </div>
      <p>Realizamos la petición</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;matriculas&quot;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-311'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-311'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaMatriculas</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-312'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-312'>#</a>
      </div>
      <h6></h6>
<p>métodos de MATRICULAS                    #</p>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">matriculasItems</span><span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">matricula</span> <span class="ow">in</span> <span class="n">listaMatriculas</span><span class="p">:</span>
            <span class="n">matriculasItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Matricula</span><span class="p">(</span> <span class="n">id_matricula</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">matricula</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span>
                                              <span class="n">id_alumno</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">matricula</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id_alumno&#39;</span><span class="p">)),</span>
                                              <span class="n">id_asociacion</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">matricula</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id_asociacion&#39;</span><span class="p">))</span>
                                            <span class="p">))</span>

        <span class="k">return</span> <span class="n">ListaMatriculas</span><span class="p">(</span><span class="n">matriculas</span><span class="o">=</span><span class="n">matriculasItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-313'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-313'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">Matricula</span><span class="p">,</span> <span class="n">MensajeRespuesta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;matriculas/insertarMatricula&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;matriculas.insertarMatricula&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">insertarMatricula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Introduce una nueva clase en el sistema.</span>

<span class="sd">        Ejemplo de llamada en terminal:</span>
<span class="sd">        curl -i -d &quot;id_alumno=2&amp;id_asociacion=2&quot; -X POST -G localhost:8001/_ah/api/helloworld/v1/matriculas/insertarMatricula</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a clases.insertarClase&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-314'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-314'>#</a>
      </div>
      <p>Identificación del módulo en el que estamos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">id_alumno</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">id_asociacion</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-315'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-315'>#</a>
      </div>
      <p>Leclear decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-316'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-316'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;matriculas&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-317'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-317'>#</a>
      </div>
      <p>Al no especificar nada se llama al método GET de la URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;id_alumno&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">id_alumno</span><span class="p">,</span>
          <span class="s2">&quot;id_asociacion&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">id_asociacion</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-318'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-318'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-319'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-319'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-320'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-320'>#</a>
      </div>
      <p>Si no tenemos todos los atributos entonces enviamos un error de bad request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-321'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-321'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;matriculas/delMatricula&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;matriculas.delMatricula&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delMatricula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Elimina una matriculación en el sistema, identificándola con su id.</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        curl -d &quot;id=2&quot; -X DELETE -G localhost:8001/_ah/api/helloworld/v1/matriculas/delMatricula</span>
<span class="sd">        {</span>
<span class="sd">         &quot;message&quot;: &quot;OK&quot;</span>
<span class="sd">        }</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición al método clases.delClase de APIGateway&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-322'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-322'>#</a>
      </div>
      <p>Añadimos el servicio al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-323'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-323'>#</a>
      </div>
      <p>Extraemos lo datos de la petición al endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;matriculas/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-324'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-324'>#</a>
      </div>
      <h1>Doc de urlfetch: https://cloud.google.com/appengine/docs/python/refdocs/google.appengine.api.urlfetch</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">DELETE</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-325'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-325'>#</a>
      </div>
      <p>Realizamos la petición al servicio con los datos pasados al endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-326'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-326'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-327'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-327'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-328'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-328'>#</a>
      </div>
      <p>Ejemplo de borrado de una matrícula:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">message_types</span><span class="o">.</span><span class="n">VoidMessage</span><span class="p">,</span> <span class="n">ListaImpartes</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;impartes/getImpartes&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;impartes.getImpartes&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getImpartes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con todos las entidades de la relación Imparte del sistema.</span>
<span class="sd">        Llamada desde terminal:</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/impartes/getImpartes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-329'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-329'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-330'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-330'>#</a>
      </div>
      <p>Extraemos el argumento id de la petición y la añadimos a la URL</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;impartes&quot;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-331'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-331'>#</a>
      </div>
      <p>Realizamos la petición a la url del servicio con el método apropiado DELETE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaImpartes</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-332'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-332'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">impartesItems</span><span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">imparte</span> <span class="ow">in</span> <span class="n">listaImpartes</span><span class="p">:</span>
            <span class="n">impartesItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Imparte</span><span class="p">(</span> <span class="n">id_profesor</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">imparte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id_profesor&#39;</span><span class="p">)),</span>
                                              <span class="n">id_clase</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">imparte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id_clase&#39;</span><span class="p">)),</span>
                                              <span class="n">id_asignatura</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">imparte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id_asignatura&#39;</span><span class="p">))</span>
                                            <span class="p">))</span>

        <span class="k">return</span> <span class="n">ListaImpartes</span><span class="p">(</span><span class="n">impartes</span><span class="o">=</span><span class="n">impartesItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-333'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-333'>#</a>
      </div>
      <p>Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">Imparte</span><span class="p">,</span> <span class="n">MensajeRespuesta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;impartes/insertarImparte&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;impartes.insertarImparte&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">insertarImparte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Introduce una relación Imparte (un procesor que imaparte una asignatura en una clase).</span>
<span class="sd">        Ejemplo de llamada en terminal:</span>
<span class="sd">        curl -i -d &quot;id_asociacion=1&amp;id_profesor=2&quot; -X POST -G localhost:8001/_ah/api/helloworld/v1/impartes/insertarImparte</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a impartes.insertarImparte&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-334'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-334'>#</a>
      </div>
      <h6></h6>
<p>métodos de IMPARTE                       #</p>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">id_profesor</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">id_asociacion</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-335'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-335'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-336'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-336'>#</a>
      </div>
      <p>Leclear decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;impartes&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-337'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-337'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;id_profesor&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">id_profesor</span><span class="p">,</span>
          <span class="s2">&quot;id_asociacion&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">id_asociacion</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-338'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-338'>#</a>
      </div>
      <p>Al no especificar nada se llama al método GET de la URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-339'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-339'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-340'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-340'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-341'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-341'>#</a>
      </div>
      <p>Si no tenemos todos los atributos entonces enviamos un error de bad request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;impartes/delImparte&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;impartes.delImparte&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delImparte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Elimina una tupla de la relación Imparte del sistema.</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        curl -d &quot;id=2&quot; -X DELETE -G localhost:8001/_ah/api/helloworld/v1/impartes/delImparte</span>
<span class="sd">        {</span>
<span class="sd">         &quot;message&quot;: &quot;OK&quot;</span>
<span class="sd">        }</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición al método clases.delClase de APIGateway&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-342'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-342'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-343'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-343'>#</a>
      </div>
      <p>Añadimos el servicio al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;impartes/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-344'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-344'>#</a>
      </div>
      <p>Extraemos lo datos de la petición al endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">DELETE</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-345'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-345'>#</a>
      </div>
      <h1>Doc de urlfetch: https://cloud.google.com/appengine/docs/python/refdocs/google.appengine.api.urlfetch</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-346'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-346'>#</a>
      </div>
      <p>Realizamos la petición al servicio con los datos pasados al endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-347'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-347'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-348'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-348'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">message_types</span><span class="o">.</span><span class="n">VoidMessage</span><span class="p">,</span> <span class="n">ListaAsociaciones</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;asociaciones/getAsociaciones&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asociaciones.getAsociaciones&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAsociaciones</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con todos las entidades de la relación Asocia del sistema.</span>
<span class="sd">        Llamada desde terminal:</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/asociaciones/getAsociaciones</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-349'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-349'>#</a>
      </div>
      <p>Ejemplo de borrado de una matrícula:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-350'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-350'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;asociaciones&quot;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-351'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-351'>#</a>
      </div>
      <p>Extraemos el argumento id de la petición y la añadimos a la URL</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
        <span class="n">listaAsociaciones</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-352'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-352'>#</a>
      </div>
      <p>Realizamos la petición a la url del servicio con el método apropiado DELETE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">asociacionesItems</span><span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">asociacion</span> <span class="ow">in</span> <span class="n">listaAsociaciones</span><span class="p">:</span>
            <span class="n">asociacionesItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Asociacion</span><span class="p">(</span> <span class="n">id_asociacion</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asociacion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span>
                                                 <span class="n">id_clase</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asociacion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id_clase&#39;</span><span class="p">)),</span>
                                                 <span class="n">id_asignatura</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asociacion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id_asignatura&#39;</span><span class="p">))</span>
                                               <span class="p">))</span>

        <span class="k">return</span> <span class="n">ListaAsociaciones</span><span class="p">(</span><span class="n">asociaciones</span><span class="o">=</span><span class="n">asociacionesItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-353'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-353'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">Asociacion</span><span class="p">,</span> <span class="n">MensajeRespuesta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;asociaciones/insertaAsociacion&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asociaciones.insertaAsociacion&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">insertarAsociacion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Introduce una relación Asocia (una especificación de una asignatura en una clase concreta).</span>
<span class="sd">        Ejemplo de llamada en terminal:</span>
<span class="sd">        curl  -d &quot;id_asignatura=2&amp;id_clase=3&quot; -X POST -G localhost:8001/_ah/api/helloworld/v1/asociaciones/insertaAsociacion</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición POST a asociaciones.insertaAsociacion&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-354'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-354'>#</a>
      </div>
      <p>Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">id_asignatura</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">id_clase</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">BadRequestException</span><span class="p">(</span><span class="s1">&#39;Peticion erronea, faltan datos.&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-355'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-355'>#</a>
      </div>
      <h6></h6>
<p>métodos de ASOCIA                       #</p>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-356'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-356'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;asociaciones&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-357'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-357'>#</a>
      </div>
      <p>Leclear decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;id_asignatura&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">id_asignatura</span><span class="p">,</span>
          <span class="s2">&quot;id_clase&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">id_clase</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-358'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-358'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">form_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">form_fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-359'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-359'>#</a>
      </div>
      <p>Al no especificar nada se llama al método GET de la URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-360'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-360'>#</a>
      </div>
      <p>Creamos un vector</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-361'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-361'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">MensajeRespuesta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;asociaciones/delImparte&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asociaciones.delImparte&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delAsociacion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Elimina una tupla de la relación Imparte del sistema.</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        curl -d &quot;id=2&quot; -X DELETE -G localhost:8001/_ah/api/helloworld/v1/impartes/delImparte</span>
<span class="sd">        {</span>
<span class="sd">         &quot;message&quot;: &quot;OK&quot;</span>
<span class="sd">        }</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Petición al método clases.delClase de APIGateway&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Contenido de la petición:&quot;</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-362'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-362'>#</a>
      </div>
      <p>Si no tenemos todos los atributos entonces enviamos un error de bad request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-363'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-363'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s1">&#39;impartes/&#39;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="n">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-364'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-364'>#</a>
      </div>
      <p>Añadimos el servicio al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">DELETE</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-365'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-365'>#</a>
      </div>
      <p>Extraemos lo datos de la petición al endpoints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s2">&quot;Resultado de la petición: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">print</span> <span class="s2">&quot;Código de estado: &quot;</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-366'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-366'>#</a>
      </div>
      <p>Doc de urlfetch: https://cloud.google.com/appengine/docs/python/refdocs/google.appengine.api.urlfetch</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-367'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-367'>#</a>
      </div>
      <p>Realizamos la petición al servicio con los datos pasados al endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">AsociacionCompleta</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;asociaciones/getAsociacionCompleta&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asociaciones.getAsociacionCompleta&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAsociacionCompleta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/asociaciones/getAsociacionCompleta?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-368'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-368'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-369'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-369'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;asociaciones/&quot;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-370'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-370'>#</a>
      </div>
      <p>Ejemplo de borrado de una matrícula:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-371'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-371'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">iac</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="k">print</span> <span class="s1">&#39;IAC recibido: </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">print</span> <span class="n">iac</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-372'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-372'>#</a>
      </div>
      <p>Extraemos el argumento id de la petición y la añadimos a la URL</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-373'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-373'>#</a>
      </div>
      <p>Realizamos la petición a la url del servicio con el método apropiado DELETE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">profesores</span><span class="o">=</span> <span class="p">[]</span>
        <span class="n">alumnos</span> <span class="o">=</span> <span class="p">[]</span>


        <span class="k">for</span> <span class="n">profesor</span> <span class="ow">in</span> <span class="n">iac</span><span class="p">[</span><span class="s1">&#39;profesoresAsociacion&#39;</span><span class="p">]:</span>
            <span class="n">profesores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ProfesorSimpleExtendido</span><span class="p">(</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span> <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">)),</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">idImparte</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">profesor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;idImparte&#39;</span><span class="p">))</span> <span class="p">))</span>

        <span class="k">for</span> <span class="n">alumno</span> <span class="ow">in</span> <span class="n">iac</span><span class="p">[</span><span class="s1">&#39;alumnosAsociacion&#39;</span><span class="p">]:</span>
            <span class="n">alumnos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AlumnoSimpleExtendido</span><span class="p">(</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)),</span> <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">)),</span> <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span> <span class="n">idMatricula</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;idMatricula&#39;</span><span class="p">))))</span>

        <span class="k">return</span> <span class="n">AsociacionCompleta</span><span class="p">(</span> <span class="n">nombreAsignatura</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">iac</span><span class="p">[</span><span class="s1">&#39;nombreAsignatura&#39;</span><span class="p">]),</span> <span class="n">listaProfesores</span><span class="o">=</span><span class="n">profesores</span><span class="p">,</span> <span class="n">listaAlumnos</span><span class="o">=</span><span class="n">alumnos</span><span class="p">,</span> <span class="n">idAsociacion</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-374'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-374'>#</a>
      </div>
      <p>Infro después de la petición:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-375'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-375'>#</a>
      </div>
      <p>Mandamos la respuesta que nos devuelve la llamada al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaAlumnos</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;asociaciones/getAlumnos&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;asociaciones.getAlumnos&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getAlumnosAsociacion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con todos los alumnos matriculados a una asociacion (Asignatura-Clase) específica.</span>
<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/asociaciones/getAlumnos?id=1</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-376'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-376'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s1">&#39; Petición GET a asociaciones.getAlumnos&#39;</span>
            <span class="k">print</span> <span class="s1">&#39; Request: </span><span class="se">\n</span><span class="s1"> &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>


        <span class="n">module</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_module_name</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_current_instance_id</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-377'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-377'>#</a>
      </div>
      <p>Leclear decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-378'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-378'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;asociaciones/&quot;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="o">+</span><span class="s2">&quot;/alumnos&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">respuestaMServicio</span><span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-379'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-379'>#</a>
      </div>
      <p>Al no especificar nada se llama al método GET de la URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">vector_alumnos</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">alumno</span> <span class="ow">in</span> <span class="n">respuestaMServicio</span><span class="p">:</span>
            <span class="n">idAlumno</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>
            <span class="n">nombreAlumno</span> <span class="o">=</span> <span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">)</span>
            <span class="n">apellidosAlumno</span> <span class="o">=</span> <span class="n">alumno</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apellidos&#39;</span><span class="p">)</span>
            <span class="n">vector_alumnos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Alumno</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="n">idAlumno</span><span class="p">,</span> <span class="n">nombre</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">nombreAlumno</span><span class="p">),</span> <span class="n">apellidos</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">apellidosAlumno</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-380'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-380'>#</a>
      </div>
      <p>Información Asociación Completa</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s1">&#39; Respuesta de asociaciones.getAlumnos&#39;</span>
            <span class="k">print</span> <span class="s1">&#39; Return: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">vector_alumnos</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">ListaAlumnos</span><span class="p">(</span><span class="n">alumnos</span><span class="o">=</span><span class="n">vector_alumnos</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-381'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-381'>#</a>
      </div>
      <p>Formateamos la información recibida para enviarla.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-382'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-382'>#</a>
      </div>
      <p>Creamos un par de vectores</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-383'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-383'>#</a>
      </div>
      <p>Relación con otras entidades.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ListaControlAsistencia</span><span class="p">,</span> <span class="n">MensajeRespuesta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;controles/insertarControl&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;controles.insertarControl&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">subirControl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Permite subir una lista de controles de asistencia.</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-384'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-384'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s1">&#39; Petición POST a controles.insertarControl&#39;</span>
            <span class="k">print</span> <span class="s1">&#39; Request: </span><span class="se">\n</span><span class="s1"> &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">print</span> <span class="s1">&#39; Request-CONTROLES: </span><span class="se">\n</span><span class="s1"> &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">controles</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-385'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-385'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-386'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-386'>#</a>
      </div>
      <p>Leclear decimos a que microservicio queremos conectarnos (solo usando el nombre del mismo), GAE descubre su URL solo.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">diccionario</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;controles&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Recorremos los controles que nos envían en el mensaje ListaControlAsistencia. Esto podemos hacerlo porque el formato de mensaje es</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        class ListaControlAsistencia(messages.Message):</span>
<span class="sd">            controles = messages.MessageField(ControlAsistencia, 1, repeated=True)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">controles</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-387'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-387'>#</a>
      </div>
      <p>Añadimos el recurso al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">tmpDic</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-388'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-388'>#</a>
      </div>
      <p>Creamos un array de alumnos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">tmpDic</span><span class="p">[</span><span class="s1">&#39;asistencia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">asistencia</span>
            <span class="n">tmpDic</span><span class="p">[</span><span class="s1">&#39;retraso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">retraso</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-389'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-389'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">tmpDic</span><span class="p">[</span><span class="s1">&#39;retrasoJustificado&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">retrasoJustificado</span>
            <span class="n">tmpDic</span><span class="p">[</span><span class="s1">&#39;uniforme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">uniforme</span>
            <span class="n">tmpDic</span><span class="p">[</span><span class="s1">&#39;idAlumno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-390'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-390'>#</a>
      </div>
      <h6></h6>
<p>métodos de CONTROL DE ESTUDIANTES        #
              mServicio SCE                #</p>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">tmpDic</span><span class="p">[</span><span class="s1">&#39;idProfesor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">idProfesor</span>
            <span class="n">tmpDic</span><span class="p">[</span><span class="s1">&#39;idClase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">idClase</span>
            <span class="n">tmpDic</span><span class="p">[</span><span class="s1">&#39;idAsignatura&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">idAsignatura</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-391'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-391'>#</a>
      </div>
      <p>@endpoints.method(message_types.VoidMessage, ListaResumenControlAsistencia )
def getAllResumenesControlAsistencia(self, request):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-392'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-392'>#</a>
      </div>
      <p>La url hay que mejorarla no necesita el /insertarControl (se identifica con el método)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">diccionario</span><span class="p">[</span><span class="s1">&#39;controles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpDic</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-393'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-393'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">jsonData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">diccionario</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-394'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-394'>#</a>
      </div>
      <p>Parseo de los datos en formato message de RPC a JSON enviable a los microservicios a través del urlfetch (seguro que hay una forma mas bonita de hacerlo)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-395'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-395'>#</a>
      </div>
      <p>Creamos un diciconario con una lista dentro llamada controles.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;sce&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-396'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-396'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;controlesAsistencia&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-397'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-397'>#</a>
      </div>
      <p>Creamos un diccionario por cada elemento dentro de controles, que es de tipo ControlAsistencia</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">jsonData</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>

        <span class="k">print</span> <span class="s1">&#39; Status code from microservice response: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-398'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-398'>#</a>
      </div>
      <p>Extraemos los datos y los insertarmos en el dic</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-399'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-399'>#</a>
      </div>
      <p>tmpDic['retrasoTiempo'] = a.retrasoTiempo</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;yeah&#39;</span> <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-400'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-400'>#</a>
      </div>
      <p>Los tres restantes vienen por la PARTE COMÚN (no en los controles)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ParametrosPeticionResumen</span><span class="p">,</span> <span class="n">ListaResumenControlAsistencia</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;controles/resumenes&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;controles.getResumenes&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getResumenesControlesAsistenciaConParametros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Devuelve una lista con todos los resumenes de los controles de estudiantes almacenados en el sistema filtrados</span>
<span class="sd">        por cualquiera de los campos.</span>

<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/controles/resumenes?idProfesor=4</span>


<span class="sd">        class ResumenControlAsistencia(messages.Message):</span>
<span class="sd">            key = messages.StringField(1, required=True)</span>
<span class="sd">            fecha = messages.StringField(2)</span>
<span class="sd">            idClase = messages.StringField(3)</span>
<span class="sd">            nombreClase = messages.StringField(4)</span>
<span class="sd">            idAsignatura = messages.StringField(5)</span>
<span class="sd">            nombreAsignatura = messages.StringField(6)</span>
<span class="sd">            idProfesor = messages.StringField(7)</span>
<span class="sd">            nombreProfesor = messages.StringField(8)</span>

<span class="sd">        class ListaResumenControlAsistencia(messages.Message):</span>
<span class="sd">            resumenes = messages.MessageField(ResumenControlAsistencia, 1, repeated=True)</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        class ParametrosPeticionResumen(messages.Message):</span>
<span class="sd">            idProfesor = messages.IntegerField(1)</span>
<span class="sd">            idAsignatura = messages.IntegerField(2)</span>
<span class="sd">            idClase = messages.IntegerField(3)</span>
<span class="sd">            fechaHora = messages.StringFiedl(4)</span>

<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-401'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-401'>#</a>
      </div>
      <p>A partir de este momento se incrustan en cada control</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s1">&#39; Petición POST a controles.getResumenes&#39;</span>
            <span class="k">print</span> <span class="s1">&#39; Request: </span><span class="se">\n</span><span class="s1"> &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-402'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-402'>#</a>
      </div>
      <p>Añadimo este tmpDic a la lista controles del diccionario principal.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;sce&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;resumenesControlesAsistenciaEspecificos&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-403'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-403'>#</a>
      </div>
      <p>Usamos la librería json para terminar de darle formato y listo para usar.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-404'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-404'>#</a>
      </div>
      <p>Fin del proceso de conversión.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">datos</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-405'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-405'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">idProfesor</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">datos</span><span class="p">[</span><span class="s1">&#39;idProfesor&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">idProfesor</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-406'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-406'>#</a>
      </div>
      <p>Añadimos el metodo al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">idAsignatura</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">datos</span><span class="p">[</span><span class="s1">&#39;idAsignatura&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">idAsignatura</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">idClase</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">datos</span><span class="p">[</span><span class="s1">&#39;idClase&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">idClase</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">fechaHora</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">datos</span><span class="p">[</span><span class="s1">&#39;fechaHora&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">fechaHora</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-407'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-407'>#</a>
      </div>
      <p>Petición al microservicio, pasándole como payload los datos recibidos aquí en el endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">print</span> <span class="n">datos</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-408'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-408'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">datos</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="n">listaResumenes</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;Resultado&#39;</span>
        <span class="k">print</span> <span class="n">listaResumenes</span>


        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        class ResumenControlAsistencia(messages.Message):</span>
<span class="sd">            key = messages.StringField(1, required=True)</span>
<span class="sd">            fecha = messages.StringField(2)</span>
<span class="sd">            idClase = messages.StringField(3)</span>
<span class="sd">            nombreClase = messages.StringField(4)</span>
<span class="sd">            idAsignatura = messages.StringField(5)</span>
<span class="sd">            nombreAsignatura = messages.StringField(6)</span>
<span class="sd">            idProfesor = messages.StringField(7)</span>
<span class="sd">            nombreProfesor = messages.StringField(8)</span>
<span class="sd">#DIVIDER</span>
<span class="sd">        class ListaResumenControlAsistencia(messages.Message):</span>
<span class="sd">            resumenes = messages.MessageField(ResumenControlAsistencia, 1, repeated=True)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">resumenesItems</span><span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">resumen</span> <span class="ow">in</span> <span class="n">listaResumenes</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;RESUMEN&#39;</span>
            <span class="k">print</span> <span class="n">resumen</span>
            <span class="k">print</span> <span class="s1">&#39;nombreClase&#39;</span>
            <span class="k">print</span> <span class="n">resumen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombreClase&#39;</span><span class="p">)</span>


            <span class="n">resumenesItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">ResumenControlAsistencia</span><span class="p">(</span> <span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">resumen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)),</span>
                                                             <span class="n">fecha</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">resumen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fecha&#39;</span><span class="p">)),</span>
                                                             <span class="n">idClase</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">resumen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;idClase&#39;</span><span class="p">)),</span>
                                                             <span class="n">nombreClase</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">resumen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombreClase&#39;</span><span class="p">)),</span>
                                                             <span class="n">idAsignatura</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">resumen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;idAsignatura&#39;</span><span class="p">)),</span>
                                                             <span class="n">nombreAsignatura</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">resumen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombreAsignatura&#39;</span><span class="p">)),</span>
                                                             <span class="n">idProfesor</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">resumen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;idProfesor&#39;</span><span class="p">)),</span>
                                                             <span class="n">nombreProfesor</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">resumen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombreProfesor&#39;</span><span class="p">))</span>
                                                           <span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-409'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-409'>#</a>
      </div>
      <p>print ' Respuesta de controles.insertarControl '+str(result)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kn">import</span> <span class="nn">time</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">ListaResumenControlAsistencia</span><span class="p">(</span><span class="n">resumenes</span><span class="o">=</span><span class="n">resumenesItems</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-410'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-410'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-411'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-411'>#</a>
      </div>
      <p>Cuando pedimos los resumenes de los controles de asistencia los podemos pedir usando parámetros o sin ellos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ListaControlAsistencia</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;controles/getControl&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;controles.getControl&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getControlAsistencia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        curl -X GET localhost:8001/_ah/api/helloworld/v1/controles/getControl?id=4644337115725824</span>

<span class="sd">        Devuelve un control de asistencia completo que se le pide con el id pasado.</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-412'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-412'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s1">&#39; Petición POST a controles.getContol&#39;</span>
            <span class="k">print</span> <span class="s1">&#39; Request: </span><span class="se">\n</span><span class="s1"> &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-413'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-413'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;sce&quot;</span><span class="p">)</span>
        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;controlAsistencia/&quot;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Llamando a: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-414'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-414'>#</a>
      </div>
      <p>Extraemos los datos pasados a la petición y los empaquetamos en un dict.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>

        <span class="k">print</span> <span class="s2">&quot;RESULTADO:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-415'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-415'>#</a>
      </div>
      <p>Creamos un diccionario</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">controlAsistencia</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="k">print</span> <span class="s1">&#39;controlAsistencia&#39;</span>
        <span class="k">print</span> <span class="n">controlAsistencia</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-416'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-416'>#</a>
      </div>
      <p>Si viene por parámetro el id del profesor lo añadimos al diccionario</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">resumenesItems</span><span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-417'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-417'>#</a>
      </div>
      <p>Hacemos lo mismo con el resto:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">listaControles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mControl</span> <span class="ow">in</span> <span class="n">controlAsistencia</span><span class="p">[</span><span class="s1">&#39;controles&#39;</span><span class="p">]:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-418'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-418'>#</a>
      </div>
      <p>Vemos como queda datos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">listaControles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ControlAsistencia</span><span class="p">(</span> <span class="n">asistencia</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mControl</span><span class="p">[</span><span class="s1">&#39;asistencia&#39;</span><span class="p">]),</span>
                                                     <span class="n">retraso</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mControl</span><span class="p">[</span><span class="s1">&#39;retraso&#39;</span><span class="p">]),</span>
                                                     <span class="n">retrasoJustificado</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mControl</span><span class="p">[</span><span class="s1">&#39;retrasoJustificado&#39;</span><span class="p">]),</span>
                                                     <span class="n">uniforme</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mControl</span><span class="p">[</span><span class="s1">&#39;uniforme&#39;</span><span class="p">]),</span>
                                                     <span class="n">nombreAlumno</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">mControl</span><span class="p">[</span><span class="s1">&#39;nombreAlumno&#39;</span><span class="p">]),</span>
                                                     <span class="nb">id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mControl</span><span class="p">[</span><span class="s1">&#39;idAlumno&#39;</span><span class="p">])</span>
                                                   <span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-419'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-419'>#</a>
      </div>
      <p>Petición al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">ListaControlAsistencia</span><span class="p">(</span> <span class="n">controles</span><span class="o">=</span><span class="n">listaControles</span><span class="p">,</span>
                                       <span class="n">idProfesor</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">controlAsistencia</span><span class="p">[</span><span class="s1">&#39;idProfesor&#39;</span><span class="p">]),</span>
                                       <span class="n">idClase</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">controlAsistencia</span><span class="p">[</span><span class="s1">&#39;idClase&#39;</span><span class="p">]),</span>
                                       <span class="n">idAsignatura</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">controlAsistencia</span><span class="p">[</span><span class="s1">&#39;idAsignatura&#39;</span><span class="p">]),</span>
                                       <span class="n">nombreClase</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">controlAsistencia</span><span class="p">[</span><span class="s1">&#39;nombreClase&#39;</span><span class="p">]),</span>
                                       <span class="n">nombreAsignatura</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">controlAsistencia</span><span class="p">[</span><span class="s1">&#39;nombreAsignatura&#39;</span><span class="p">]),</span>
                                       <span class="n">nombreProfesor</span><span class="o">=</span><span class="n">formatText</span><span class="p">(</span><span class="n">controlAsistencia</span><span class="p">[</span><span class="s1">&#39;nombreProfesor&#39;</span><span class="p">]),</span>
                                       <span class="n">fecha</span><span class="o">=</span><span class="n">controlAsistencia</span><span class="p">[</span><span class="s1">&#39;fechaHora&#39;</span><span class="p">]</span>
                                     <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-420'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-420'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-421'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-421'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">class</span> <span class="nc">Imagen</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">image</span>  <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">BytesField</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-422'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-422'>#</a>
      </div>
      <p>Pequeño delay para pruebas con el css</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">Imagen</span><span class="p">,</span> <span class="n">MensajeRespuesta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;imagenes/subirImagen&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;imagenes.subirImagen&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">subirImagen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="k">print</span> <span class="s1">&#39;Nombre recibido:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">print</span> <span class="n">request</span><span class="o">.</span><span class="n">name</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-423'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-423'>#</a>
      </div>
      <p>return MensajeRespuesta(message="Hola ke ase!")</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">         (echo -n &#39;{&quot;image&quot;: &quot;&#39;; base64 profile.jpg; echo &#39;&quot;}&#39;) | curl -H &quot;Content-Type: application/json&quot;  -d @-  localhost:8001/_ah/api/helloworld/v1/imagenes/subirImagen?name=prueba</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-424'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-424'>#</a>
      </div>
      <p>La url hay que mejorarla, no necesita el /getControl (Se identifica con el método)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ##### IMAGEN RECIBIDA EN API ENDPOINTS: #####</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Imagen en CRUDO: </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">binascii</span>
        <span class="n">stringBase64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Imagen pasada a de Base64 a string: </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">print</span> <span class="n">stringBase64</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-425'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-425'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">print</span> <span class="s1">&#39;URL </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">ManejadorImagenes</span><span class="o">.</span><span class="n">CreateFile</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">url</span>

        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span> <span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-426'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-426'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">MensajeRespuesta</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;imagenes/eliminarImagen&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;imagenes.eliminarImagen&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">eliminarImagen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        curl -X POST localhost:8001/_ah/api/helloworld/v1/imagenes/eliminarImagen?url=http://localhost:8001/_ah/img/encoded_gs_file:YXBwX2RlZmF1bHRfYnVja2V0L2Zpbm4uanBlZw==</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MensajeRespuesta</span><span class="p">(</span> <span class="n">message</span><span class="o">=</span><span class="n">ManejadorImagenes</span><span class="o">.</span><span class="n">DeleteFile</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-427'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-427'>#</a>
      </div>
      <p>Petición al microservicio</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-428'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-428'>#</a>
      </div>
      <p>Convertimos el json a un objeto python</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-429'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-429'>#</a>
      </div>
      <p>Convertirmos este objeto python al mensja de rpc para ser enviado.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@endpoints.method</span><span class="p">(</span><span class="n">Login</span><span class="p">,</span> <span class="n">salidaLogin</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;login/loginUser&#39;</span><span class="p">,</span> <span class="n">http_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login.loginUser&#39;</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">loginUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Comprueba si un usaurio está en elsistema y en caso de estarlo devuelve su ron y su número de identificación.</span>
<span class="sd">        curl -d &quot;username=46666&amp;password=46666&quot; -i -X POST -G localhost:8001/_ah/api/helloworld/v1/login/loginUser</span>
<span class="sd">        &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-430'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-430'>#</a>
      </div>
      <p>Recorremos todos los elementos de la lista 'controles' del diccionario devuelto por el mservicio sce.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s1">&#39; Petición POST a login.loginUser&#39;</span>
            <span class="k">print</span> <span class="s1">&#39; Request: </span><span class="se">\n</span><span class="s1"> &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-431'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-431'>#</a>
      </div>
      <p>print 'mControl'
print mControl</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="n">modules</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;microservicio1&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-432'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-432'>#</a>
      </div>
      <p>Una vez que tenemos la lista componemos el mensaje final</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">url</span><span class="o">+=</span><span class="s2">&quot;comprobarAccesoUsuario&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-433'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-433'>#</a>
      </div>
      <h6></h6>
<p>Manejo de imágenes                       #</p>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">datos</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">username</span><span class="p">),</span>
          <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">formatTextInput</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">password</span><span class="p">),</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-434'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-434'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">result</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">datos</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">urlfetch</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

        <span class="n">json</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">json</span><span class="o">==</span><span class="s1">&#39;Usuario no encontrado&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">NotFoundException</span><span class="p">(</span><span class="s1">&#39;Usuario no encontrado&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mensajeSalida</span><span class="o">=</span><span class="n">salidaLogin</span><span class="p">(</span><span class="n">idUser</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;idUsuario&#39;</span><span class="p">]),</span> <span class="n">nombre</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">]),</span> <span class="n">rol</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-435'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-435'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nombreMicroservicio</span>
            <span class="k">print</span> <span class="s1">&#39; Return: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mensajeSalida</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>


        <span class="k">return</span> <span class="n">mensajeSalida</span>



<span class="n">APPLICATION</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">api_server</span><span class="p">([</span><span class="n">HelloWorldApi</span><span class="p">])</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-436'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-436'>#</a>
      </div>
      <p>curl -d "nombre=JuanAntonio" -i -X POST -G localhost:8001/_ah/api/helloworld/v1/imagenes/subirImagen</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-437'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-437'>#</a>
      </div>
      <p>curl -d "nombre=prueba" -X POST localhost:8001/_ah/api/helloworld/v1/imagenes/subirImagen</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-438'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-438'>#</a>
      </div>
      <p>print request.image.decode(encoding='UTF-8')</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-439'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-439'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-440'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-440'>#</a>
      </div>
      <h6></h6>
<p>métodos de CREDENCIALES                  #</p>
<h6></h6>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-441'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-441'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-442'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-442'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-443'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-443'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-444'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-444'>#</a>
      </div>
      <p>Conformamos la dirección:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-445'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-445'>#</a>
      </div>
      <p>Añadimos el metodo al que queremos conectarnos.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-446'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-446'>#</a>
      </div>
      <p>Extraemos lo datos de la petición al endpoints y empaquetamos un dict.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-447'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-447'>#</a>
      </div>
      <p>Petición al microservicio:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-448'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-448'>#</a>
      </div>
      <p>Info de seguimiento</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
